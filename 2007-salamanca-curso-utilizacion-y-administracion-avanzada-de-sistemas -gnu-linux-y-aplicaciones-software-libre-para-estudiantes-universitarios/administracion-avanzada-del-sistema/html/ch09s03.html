<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Permisos SUID y SGID</title><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"><link rel="start" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="up" href="ch09.html" title="Capítulo 9. Auditoria y Logs"><link rel="prev" href="ch09s02.html" title="Usuarios que estuvieron en el sistema"><link rel="next" href="ch09s04.html" title="El demonio syslogd"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Permisos <span class="emphasis"><em>SUID</em></span> y <span class="emphasis"><em>SGID</em></span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09s02.html">Anterior</a> </td><th width="60%" align="center">Capítulo 9. Auditoria y Logs</th><td width="20%" align="right"> <a accesskey="n" href="ch09s04.html">Siguiente</a></td></tr></table><hr></div><div class="sect1" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2572261"></a>Permisos <span class="emphasis"><em>SUID</em></span> y <span class="emphasis"><em>SGID</em></span></h2></div></div></div><p>Los ficheros con estos permisos activados es necesario tenerlos controlados ya que se ejecutan con los privilegios de su propietario y no del usuario que los ejecuta. Si el propietario es el <span class="emphasis"><em>root</em></span> un mal uso puede comprometer el sistema.</p><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2572283"></a>Peligros con estos permisos</h3></div></div></div><p>Tengamos el siguiente programa:</p><pre class="programlisting">
#include &lt;stdio.h&gt;

#define SIZE 2000

int main (void) {
  FILE *ptFichero;
  char chrBuffer[SIZE];
  int intLeidos;

  /* ABRIMOS EL FICHERO EN SOLO LECTURA */
  ptFichero = fopen("/etc/shadow", "r");
  
  /* LEEMOS 2000 CARACTERES */
  intLeidos = fread(chrBuffer, sizeof(char), SIZE, ptFichero);

  /* SACAMOS POR LA SALIDA ESTANDAR LOS CARACTERES LEIDOS */
  fwrite(chrBuffer, sizeoff(char), intLeidos, stdout);

  /* CERRAMOS EL FICHERO */
  fclose(ptFichero);

  return 0;
}
</pre><p>Y a continuación lo compilamos y hacemos lo siguiente:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>cp exploit /media/pendrive</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>chmod 4755 /media/pendrive</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>ls -lh /media/pendrive/exploit</code></strong>
<code class="computeroutput">-rwsr-xr-x 1 root root 1,9K 2007-04-11 12:38 exploit</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Si a continuación llevamos ese pendrive a un equipo en el que tengamos privilegios para montarlo y esté permitido la ejecución de <span class="emphasis"><em>SUID</em></span>. En ese equipo podremos leer el contenido del fichero <code class="filename">/etc/shadow</code> sin ser el usuario <span class="emphasis"><em>root</em></span>.</p><p>Si en lugar de lectura hubieramos programado que sustituyera el password del usuario <span class="emphasis"><em>root</em></span> por uno conocido por nosotros tendríamos acceso a <span class="emphasis"><em>root</em></span> en esa máquina.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Aviso</h3><p>Por cosas como esta es por lo que NUNCA el comando <span><strong class="command">chown</strong></span> debería tener activados los permisos SUID.</p><p>Aunque las implementaciones de hoy en día de este comando eliminan los permisos <span class="emphasis"><em>SUID</em></span> y <span class="emphasis"><em>SGID</em></span> en implementaciones viejas no lo hacían y era un agujero de seguridad.</p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2572428"></a>Evitando la ejecución de ficheros con esos permisos</h3></div></div></div><p>La mejor forma es indicar <span class="emphasis"><em>nosuid</em></span> en las opciones en el fichero <code class="filename">/etc/fstab</code> de los sistemas de ficheros en los que no sea necesario ejecuciones <span class="emphasis"><em>SUID</em></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p>En los sistemas de ficheros que pueden montar los usuarios es más que recomendable utilizar la opció <span class="emphasis"><em>nosuid</em></span> y puede que también <span class="emphasis"><em>noexec</em></span>.</p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2572469"></a>Localizando estos ficheros</h3></div></div></div><p>Antés de nada recordemos un par de cosas:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>SUID</em></span> los ficheros con este permiso activado tienen permisos mayores, en octal, que 4000.</p></li><li><p><span class="emphasis"><em>SGID</em></span> los ficheros con este permiso activado tienen permisos mayores, en octal, que 2000.</p></li><li><p><span class="emphasis"><em>Sticky Bit</em></span> los ficheros con este permiso activado tienen permisos mayores, en octal, que 1000.</p></li></ul></div><p>Para localizar a todos los ficheros con permiso <span class="emphasis"><em>SUID</em></span> activado:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>find / -perm +4000 -exec ls -l {} \;</code></strong>
</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09s02.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch09.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09s04.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Usuarios que estuvieron en el sistema </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> El demonio <span class="emphasis"><em>syslogd</em></span></td></tr></table></div></body></html>
