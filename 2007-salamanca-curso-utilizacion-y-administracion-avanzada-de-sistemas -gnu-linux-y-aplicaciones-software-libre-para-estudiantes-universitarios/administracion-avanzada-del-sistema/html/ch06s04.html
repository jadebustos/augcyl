<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Multipathing utilizando LVM</title><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"><link rel="start" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="up" href="ch06.html" title="Capítulo 6. Introducción al uso de SAN en GNU/Linux"><link rel="prev" href="ch06s03.html" title="Dispositivos virtuales"><link rel="next" href="ch07.html" title="Capítulo 7. Núcleo de Linux"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Multipathing utilizando <span class="emphasis"><em>LVM</em></span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06s03.html">Anterior</a> </td><th width="60%" align="center">Capítulo 6. Introducción al uso de <span class="emphasis"><em>SAN</em></span> en GNU/Linux</th><td width="20%" align="right"> <a accesskey="n" href="ch07.html">Siguiente</a></td></tr></table><hr></div><div class="sect1" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2561355"></a>Multipathing utilizando <span class="emphasis"><em>LVM</em></span></h2></div></div></div><p>Es posible hacer multipathing utilizando <span class="emphasis"><em>LVM</em></span> pero sólo con unas determinadas versiones. Existen parches para las versiones <span class="emphasis"><em>1.0.5</em></span>, <span class="emphasis"><em>1.0.6</em></span>, <span class="emphasis"><em>1.0.7</em></span> y <span class="emphasis"><em>1.0.8</em></span>.</p><p>La única distribución en la que viene configurado el kernel para el uso de este multipathing es <span class="emphasis"><em>SLES 8</em></span>.</p><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2561394"></a>Localizando los dispositivos físicos</h3></div></div></div><p>Una vez añadidos los dispositivos físicos al sistema tendremos tantos dispositivos como caminos por disco. Para cada disco físico utilizaremos un dispositivo especifico de todos los que lo referencian, lo llamaremos <span class="emphasis"><em>dispositivo primario</em></span> para ese disco. El comando <span class="emphasis"><em>pvscan</em></span> nos identificará estos dispositivos:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvscan</code></strong>
<code class="computeroutput">pvscan -- reading all physical volumes (this may take a while...)
pvscan -- ACTIVE   PV "/dev/sdaw"  of VG "data_vg"     [18.62 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdax"  of VG "data_vg"     [46.56 GB / 26.98 GB free]
pvscan -- ACTIVE   PV "/dev/sdav"  of VG "data_vg"     [46.56 GB / 46.56 GB free]
pvscan -- ACTIVE   PV "/dev/sdag"  of VG "data_vg"     [46.56 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdah"  of VG "data_vg"     [9.31 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdai"  of VG "data_vg"     [46.56 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdaj"  of VG "data_vg"     [46.56 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdak"  of VG "data_vg"     [19.18 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdal1" of VG "software_vg" [5 GB / 116 MB free]
pvscan -- ACTIVE   PV "/dev/sdal2" of VG "data_vg"     [14.18 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdad"  of VG "data_vg"     [46.56 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdae"  of VG "data_vg"     [18.62 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sdaf"  of VG "data_vg"     [9.31 GB / 0 free]
pvscan -- ACTIVE   PV "/dev/sda13" of VG "system_vg"   [16.77 GB / 2.96 GB free]
pvscan -- total: 14 [390.43 GB] / in use: 14 [390.43 GB] / in no VG: 0 [0]</code>
<code class="prompt">[root@sal]# </code>
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>Es necesario que los discos ya esten asignados a un grupo de volumen.</p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2561490"></a>Configurando el multipath</h3></div></div></div><p>Lo haremos en tres pasos:</p><div class="orderedlist"><ol type="1"><li><p>Tendremos que configurar el multipath sobre los dispositivos primarios mostrados por <span><strong class="command">pvscan</strong></span> suponiendo que hay cuatro caminos por dispositivo:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvpath -p 0 -e y -w 1 /dev/sdaw</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvpath -p 1 -e y -w 2 /dev/sdaw</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvpath -p 2 -e y -w 1 /dev/sdaw</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvpath -p 3 -e y -w 2 /dev/sdaw</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvpath -q /dev/sdaw</code></strong>
<code class="computeroutput">Physical volume /dev/sdaw of data_vg has 4 paths:
       Device  Weight Failed Pending State
 #  0:   8:16       1      0       0 enabled
 #  1:   8:32       2      0       0 enabled
 #  2:   8:48       1      0       0 enabled
 #  3:   8:64       2      0       0 enabled</code>
<code class="prompt">[root@sal]# </code>
</pre></li><li><p>Una vez configurados todos los caminos tendremos que grabar la configuración:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>pvpathsave</code></strong>
<code class="prompt">[root@sal]# </code>
</pre><p>Esta configuración se almacena en el fichero <code class="filename">/etc/pvpath.cfg</code>.</p></li><li><p>Tenemos que hacer que está configuración se lea antés de utilizar los dispositivos. Para ello nos aseguraremos de que el fichero <code class="filename">/etc/init.d/boot.local</code> contiene <code class="filename">/sbin/pvpathrestore</code>.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>En otras distribuciones diferentes de <span class="emphasis"><em>SLES 8</em></span> será en un fichero equivalente.</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>Si la máquina está arrancando desde <span class="emphasis"><em>SAN</em></span> será necesario hacer este último paso si queremos que la máquina arranque.</p></div></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06s03.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch06.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch07.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Dispositivos virtuales </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Capítulo 7. Núcleo de Linux</td></tr></table></div></body></html>
