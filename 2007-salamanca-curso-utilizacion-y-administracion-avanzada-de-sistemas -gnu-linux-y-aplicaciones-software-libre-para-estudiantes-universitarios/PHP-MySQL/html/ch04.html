<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Capítulo 4. Inclusión de relaciones</title><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"><link rel="start" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="up" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="prev" href="ch03.html" title="Capítulo 3. Otros ejemplos"><link rel="next" href="ch04s02.html" title="Conclusiones"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Capítulo 4. Inclusión de relaciones</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03.html">Anterior</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch04s02.html">Siguiente</a></td></tr></table><hr></div><div class="chapter" lang="es"><div class="titlepage"><div><div><h2 class="title"><a name="id2545798"></a>Capítulo 4. Inclusión de relaciones</h2></div></div></div><div class="toc"><p><b>Tabla de contenidos</b></p><dl><dt><span class="section"><a href="ch04.html#id2545923">Directorio de Alumnos</a></span></dt><dt><span class="section"><a href="ch04s02.html">Conclusiones</a></span></dt></dl></div><div class="section" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2545923"></a>Directorio de Alumnos</h2></div></div></div><p></p><p>index.php de alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");

          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Búsqueda de Asignaturas&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;p&gt;Búsqueda de Asignaturas.&lt;/p&gt;&lt;?php
              // coloca el enlace que permite añadir un alumno
              echo "&lt;p&gt;&lt;A HREF='nuevo.php'&gt;Nuevo&lt;/A&gt;&lt;/p&gt;";
              // se inicia el formulario de la búsqueda
              echo "&lt;form method=\"post\" action=\"buscar.php\"&gt;";
              // se indica que el campo de busqueda tiene 20 caracteres de longitud
              echo "&lt;input type=\"text\" name=\"busqueda\" size=20 maxlength =100 value=\"".$_POST['busqueda']."\"&gt;";
              // se coloca el boton que se paretara para realizar la busqueda
              echo "&lt;input type=\"submit\" name=\"buscar\" value=\"Buscar\"&gt;&lt;/form&gt;&lt;br&gt;";
              // se rellena la busqueda por todos los campos de la tabla, se debe substituir alumnos por el nombre de la tabla y 
              // poner tantos nombre_de_campo LIKE '%".$_POST['busqueda']."%' OR como campos haya.
              $sql="SELECT * FROM asignaturas where nombre LIKE '%".$_POST['busqueda']."%';";
              // se realiza la busqueda
              $result=mysql_query($sql,$conexion);
              //Se comprueba si hay resultados en la busqueda
              if($row= mysql_fetch_array($result)){
              // si hay resultados crea la tabla
              echo "&lt;TABLE BORDER='1'&gt;";
              //pone los campos de la tabla tiene que haber tantos &lt;TD CLASS=\"titulo\"&gt;Nombre_de_campo&lt;/TD&gt; como campos haya
              echo "&lt;TR&gt;&lt;TD CLASS=\"titulo\"&gt;Nombre&lt;/TD&gt;&lt;TD colspan=3  CLASS=\"titulo\"&gt;Opciones&lt;/TD&gt;&lt;/TR&gt;";
              //coloca las líneas de la tabla
              DO
              {
              //aqui se ponen tantas líneas &lt;TD width=300 CLASS=\"linea\"&gt;".$row["nombre_de_campo"]."&lt;/TD&gt; como campos haya en la tabla
              // se coloca el inicio de la fila
              echo "&lt;TR&gt;";
              //se coloca el campos del nombre
              echo "&lt;TD width=300 CLASS=\"linea\"&gt;".$row["nombre"]."&lt;/TD&gt;";
              //se colocan los enlaces de ver editar y borrar alumno
              echo "&lt;TD CLASS=\"linea\"&gt;&lt;A HREF=ver.php?id=".$row['id']."&gt;Ver&lt;/A&gt;&lt;/TD&gt;";
              echo "&lt;TD width=50 CLASS=\"linea\"&gt;&lt;A HREF=editar.php?id=".$row['id']."&gt;Editar&lt;/A&gt;&lt;/TD&gt;";
              echo "&lt;TD width=50 CLASS=\"linea\"&gt;&lt;A HREF=borrar.php?id=".$row['id']."&gt;Borrar&lt;/A&gt;&lt;/TD&gt;";
              //se termina la fila
              echo "&lt;/TR&gt;";
              }
              //Comprueba si se ha terminado de poner líneas
              WHILE ($row=mysql_fetch_array($result));
              //como se ha terminado de poner líneas se acaba la tabla
              echo "&lt;/TABLE&gt;&lt;br&gt;";
              //coloca el enlace para volver al listado
              echo "&lt;A HREF=\"index.php\"&gt;Volver&lt;/A&gt;";
              }else{
              //si no hay registros que coincidan con la busqueda se le indica al usuario
              echo "La búsqueda no coincide con ningún registro de la BBDD&lt;BR&gt;";
              //se coloca el enlace del volver al listado
              echo "&lt;A HREF=\"index.php\"&gt;Volver&lt;/A&gt;";

              }
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>Nótese como en la tercera parte del fichero
      hay una nueva consulta en busca de los nombres de los tipos
      de alumno para poder encontrar el nombre de la que
      está relacionada con cada alumno. Por lo
      demás es como cualquier otro index.php de
      directorio.</p><p>ver.php de alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");
          //rellenamos la consulta, cambiar alumnos por el nombre de la tabla a listar
          $sql="Select * from alumnos WHERE id=".$_GET['id'].";";
          //re realiza la consulta
          $result=mysql_query($sql,$conexion);
          //print $sql;
          //se coge el registro del alumno
          $row= mysql_fetch_array($result);
          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Alumno:&lt;?php echo $row['nombre']; ?&gt;&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              //en esta parte se muestran los campos del alumno
              //se debe añadir líneas tantas como campos tenga la tabla: echo "&lt;p&gt;Nombre de campo:".$row["nombre_de_campo"]."&lt;/p&gt;";
              //se muestra el código del alumno
              echo "&lt;p&gt;Código:".$row["id"]."&lt;/p&gt;";
              //se muestra el nombre del alumno
              echo "&lt;p&gt;Nombre:".$row["nombre"]."&lt;/p&gt;";
              //se muestra el dni del alumno
              echo "&lt;p&gt;DNI:".$row["dni"]."&lt;/p&gt;";
              $sql2="Select * from tipos_de_alumno where id_tipo_de_alumno=".$row['id_tipo_de_alumno'].";";
              //echo $sql2;
              //re realiza la consulta para meter en $result2 los tipos de alumnos
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 el primer tipo de alumno
              $row2= mysql_fetch_array($result2);
              echo "&lt;p&gt;Tipo de Alumno:".$row2["nombre"]."&lt;/p&gt;";
              //se coloca el enlace para que pueda editarse el alumno.
              echo "&lt;p&gt;&lt;A HREF=editar.php?id=".$row['id']."&gt;Editar&lt;/A&gt;&lt;/TD&gt;&lt;/p&gt;";
              // se coloca el enlace para borrar el alumno
              echo "&lt;p&gt;&lt;A HREF=borrar.php?id=".$row['id']."&gt;Borrar&lt;/A&gt;&lt;/TD&gt;&lt;/p&gt;";
              // se coloca el enlace para ver la matriculas de alumno
              echo "&lt;p&gt;&lt;A HREF=ver_matriculas.php?id=".$row['id']."&gt;Ver Matriculas&lt;/A&gt;&lt;/TD&gt;&lt;/p&gt;";
              // se coloca el enlace para ir a listado de alumnos
              echo "&lt;p&gt;&lt;A HREF='index.php'&gt;Atras&lt;/A&gt;&lt;/p&gt;";
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>Aquí al final de la tercera parte se ve como
      se muestra un enlace a un nuevo fichero que permite la
      visualización de las matrículas de
      dicho alumno.</p><p>editar.php de alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php 
          //incluimos el fichero config.php para coger los datos de la conexi?n
          include_once('../config.php');
          //cogemos las variables de las coneci?n para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexi?n
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");
          //rellenamos la consulta, cambiar alumnos por el nombre de la tabla a listar
          $sql="Select * from alumnos WHERE id=".$_GET['id'].";";
          //re realiza la consulta
          $result=mysql_query($sql,$conexion);
          //print $sql;
          //se coge el registro del alumno
          $row= mysql_fetch_array($result);
          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Nuevo Alumno&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              //se mira si se est? enviando el formulario de edici?n del alumno
              if(!isset( $_POST['editar']))
              {
              //Si se est? enviando el formulario
              //echo "&lt;p&gt;Vuelva a intentarlo&lt;/p&gt;";
              //se abre el formulario que envia los datos de las modificaciones de ese registro
                              echo "&lt;form method=\"post\" action=\"editar.php?id=".$_GET['id']."\" &gt;";
              // muestra el c?digo del alumno
                              echo "Codigo:".$row['id']."&lt;br&gt;";
              // a partir de aqui se muestran los campos a rellenar en el formulario
              // si se substituye echo "Nombre : &lt;input type=\"text\" name=\"nombre\" value=\"".$row['nombre']."\" maxlength =200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_de_campo\" value=\"".$row['nombre']."\" maxlength =longitud_maxima_de_campo 
              //  size=tama?o_dte_la_caja&gt;&lt;br&gt;";
              // se muestra la caja del nombre del alumno
                              echo "Nombre : &lt;input type=\"text\" name=\"nombre\" value=\"".$row['nombre']."\" maxlength =200 size=40&gt;&lt;br&gt;";
              // se muestra la caja del dni
                              echo "DNI : &lt;input type=\"text\" name=\"dni\" value=\"".$row['dni']."\" maxlength =10 size=10&gt;&lt;br&gt;";
              //inicia la combo de los tipos
              echo "Tipo de Alumno:";
              echo "&lt;select name=\"tipo_de_alumno\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from tipos_de_alumno;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option value=\"".$row2['id_tipo_de_alumno']."\"";
              if($row2['id_tipo_de_alumno']==$row['id_tipo_de_alumno'])
                      echo "selected";
              echo "&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más tipos de alumno
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas tipos de alumno cierra el listado
              echo "&lt;/select&gt; &lt;br&gt;&lt;br&gt;";
              // se pone el bot?n de guardar los datos
                              echo "&lt;input type=\"submit\" name=\"editar\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
              }else{
              // si se env?a el formulario hay que coger los datos del formulario y meterlos en la BBDD
              // aqui se deben a?adir tantos isset($_POST['nombre_de_campo']) &amp;&amp; como campos haya en la bbdd
                      if(isset($_POST['nombre']) &amp;&amp; isset($_POST['dni']) &amp;&amp; isset($_POST['tipo_de_alumno'])){
              //se desactiva el contenido de la variable $sql
                              unset($sql);
              // se rellena la consulta que inserta los datos
              //se ponen tantos `nombre_de_campo` = '".$_POST['nombre_de_campo']."',

                              $sql="UPDATE `alumnos` SET `nombre` = '".$_POST['nombre']."',`dni` = '".$_POST['dni']."',`id_tipo_de_alumno` = '".
                              $_POST['tipo_de_alumno']."' WHERE `id` =".$_GET['id']." LIMIT 1 ;";
                              //echo $sql;
                              //print_r ($_POST);
              //se envia la inserci?n de datos en la BBDD
                              $result=mysql_query($sql,$conexion);
              //Se informa por la p?gina web que el alumno ha sido modificado
                              echo "&lt;p&gt;Alumno Modificado&lt;/p&gt;";
              //se coloca el bot?n que hace volver al listado de alumnos
                              echo "&lt;p&gt;&lt;A HREF='index.php'&gt;Volver&lt;/A&gt;&lt;/p&gt;";
                      }else{
                      // se informa al usuario que no se han rellenado los campos
              print_r($_POST);
                      echo "Vuelva a intentarlo.&lt;br&gt;";
                      //se abre el formulario que envia los datos de las modificaciones de ese registro
                              echo "&lt;form method=\"post\" action=\"editar.php?id=".$_GET['id']."\" &gt;";
              // muestra el c?digo del alumno
                              echo "Codigo:".$row['id']."&lt;br&gt;";
              // a partir de aqui se muestran los campos a rellenar en el formulario
              // si se substituye echo "Nombre : &lt;input type=\"text\" name=\"nombre\" value=\"".$row['nombre']."\" maxlength =200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_de_campo\" value=\"".$row['nombre']."\" maxlength =longitud_maxima_de_campo 
              // size=tama?o_dte_la_caja&gt;&lt;br&gt;";
              // se muestra la caja del nombre del alumno
                              echo "Nombre : &lt;input type=\"text\" name=\"nombre\" value=\"".$row['nombre']."\" maxlength =200 size=40&gt;&lt;br&gt;";
              // se muestra la caja del dni
                              echo "DNI : &lt;input type=\"text\" name=\"dni\" value=\"".$row['dni']."\" maxlength =10 size=10&gt;&lt;br&gt;";
              // se pone el bot?n de guardar los datos
                              echo "&lt;input type=\"submit\" name=\"editar\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";    
                      }
              }
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>Cabe destacar la segúnda búsqueda
      en la tabla de tipos de alumno para ocnstuir el tag select
      (combobox)</p><p>borrar.php de alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php 
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");
          //rellenamos la consulta, cambiar alumnos por el nombre de la tabla a listar
          $sql="Select * from alumnos WHERE id=".$_GET['id'].";";
          //re realiza la consulta
          $result=mysql_query($sql,$conexion);
          //print $sql;
          //se coge el registro del alumno
          $row= mysql_fetch_array($result);
          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Borrar Alumno&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              // se rellena la consulta que borra el alumno se substituye alumno por el nombre de la tabla 
              $sql="DELETE from `alumnos` WHERE `id` =".$_GET['id']." LIMIT 1 ;";
              //echo $sql;
              // se ejecuta la consulta se borrado
              $result=mysql_query($sql,$conexion);
              // se informa de que se ha eliminado un alumno
              echo "&lt;p&gt;Alumno eliminado&lt;/p&gt;";
              // se coloca el enlace que permite volver al listado
              echo "&lt;p&gt;&lt;A HREF='index.php'&gt;Volver&lt;/A&gt;&lt;/p&gt;";

              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>buscar.php de alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");

          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Búsqueda de Alumnos&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;p&gt;Búsqueda de Alumnos.&lt;/p&gt;&lt;?php
              // coloca el enlace que permite añadir un alumno
              echo "&lt;p&gt;&lt;A HREF='nuevo.php'&gt;Nuevo&lt;/A&gt;&lt;/p&gt;";
              // se inicia el formulario de la búsqueda
              echo "&lt;form method=\"post\" action=\"buscar.php\"&gt;";
              // se indica que el campo de busqueda tiene 20 caracteres de longitud
              echo "&lt;input type=\"text\" name=\"busqueda\" size=20 maxlength =20 value=\"".$_POST['busqueda']."\"&gt;";
              // se coloca el boton que se paretara para realizar la busqueda
              echo "&lt;input type=\"submit\" name=\"buscar\" value=\"Buscar\"&gt;&lt;/form&gt;&lt;br&gt;";
              // se rellena la busqueda por todos los campos de la tabla, se debe substituir alumnos por el nombre de la tabla y poner tantos nombre_de_campo LIKE '%".$_POST['busqueda']."%' OR como campos haya.
              $sql="SELECT * FROM alumnos where nombre LIKE '%".$_POST['busqueda']."%' OR dni LIKE '%".$_POST['busqueda']."%';";
              // se realiza la busqueda
              $result=mysql_query($sql,$conexion);
              //Se comprueba si hay resultados en la busqueda
              if($row= mysql_fetch_array($result)){
              // si hay resultados crea la tabla
              echo "&lt;TABLE BORDER='1'&gt;";
              //pone los campos de la tabla tiene que haber tantos &lt;TD CLASS=\"titulo\"&gt;Nombre_de_campo&lt;/TD&gt; como campos haya
              echo "&lt;TR&gt;&lt;TD CLASS=\"titulo\"&gt;Nombre&lt;/TD&gt;&lt;TD CLASS=\"titulo\"&gt;DNI&lt;/TD&gt;&lt;TD colspan=3  CLASS=\"titulo\"&gt;Opciones&lt;/TD&gt;&lt;/TR&gt;";
              //coloca las líneas de la tabla
              DO
              {
              //aqui se ponen tantas líneas &lt;TD width=300 CLASS=\"linea\"&gt;".$row["nombre_de_campo"]."&lt;/TD&gt; como campos haya en la tabla
              // se coloca el inicio de la fila
              echo "&lt;TR&gt;";
              //se coloca el campos del nombre
              echo "&lt;TD width=300 CLASS=\"linea\"&gt;".$row["nombre"]."&lt;/TD&gt;";
              //se coloca el campo del dni
              echo "&lt;TD width=160 CLASS=\"linea\"&gt;".$row["dni"]."&lt;/TD&gt;";
              //se colocan los enlaces de ver editar y borrar alumno
              echo "&lt;TD CLASS=\"linea\"&gt;&lt;A HREF=ver.php?id=".$row['id']."&gt;Ver&lt;/A&gt;&lt;/TD&gt;";
              echo "&lt;TD width=50 CLASS=\"linea\"&gt;&lt;A HREF=editar.php?id=".$row['id']."&gt;Editar&lt;/A&gt;&lt;/TD&gt;";
              echo "&lt;TD width=50 CLASS=\"linea\"&gt;&lt;A HREF=borrar.php?id=".$row['id']."&gt;Borrar&lt;/A&gt;&lt;/TD&gt;";
              //se termina la fila
              echo "&lt;/TR&gt;";
              }
              //Comprueba si se ha terminado de poner líneas
              WHILE ($row=mysql_fetch_array($result));
              //como se ha terminado de poner líneas se acaba la tabla
              echo "&lt;/TABLE&gt;&lt;br&gt;";
              //coloca el enlace para volver al listado
              echo "&lt;A HREF=\"index.php\"&gt;Volver&lt;/A&gt;";
              }else{
              //si no hay registros que coincidan con la busqueda se le indica al usuario
              echo "La búsqueda no coincide con ningún registro de la BBDD&lt;BR&gt;";
              //se coloca el enlace del volver al listado
              echo "&lt;A HREF=\"index.php\"&gt;Volver&lt;/A&gt;";

              }
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>nuevo.php de alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php 
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");

          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Nuevo Alumno&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              //comprueba si se entas enviando datos para guardar
              //si no es asi es que tiene que presentar el formulario
              if(!isset( $_POST['nuevo']))
              {
              //coloca el principio del formulario para que vuelva al mismo script cuando se rellene
                      echo "&lt;form method=\"post\" action=\"nuevo.php\"&gt;";
              //aqui se deben poner tantas líneas echo como campos haya
              //cambiando el echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength=200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_campo\" maxlength=longitud_campo size=tamaño_caja_texto&gt;&lt;br&gt;";
              // se muestra la caja del nombre del alumno
                              echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength =100 size=40&gt;&lt;br&gt;";
              // se muestra la caja del dni del alumno
                              echo "DNI : &lt;input type=\"text\" name=\"dni\" maxlength =15 size=9&gt;&lt;br&gt;";
              //inicia la combo de los tipos
              echo "Tipo de Alumno:";
              echo "&lt;select name=\"tipo_de_alumno\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from tipos_de_alumno;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option value=\"".$row2['id_tipo_de_alumno']."\"&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más tipos de alumno
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas tipos de alumno cierra el listado
              echo "&lt;/select&gt; &lt;br&gt;&lt;br&gt;";
              ////se coloca el botón de guardar
                      echo "&lt;input type=\"submit\" name=\"nuevo\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
              }else{
              //si se han metido los datos en el formulario
              //se deben colocar tantos isset($_POST['nombre_campo']) &amp;&amp; como campos haya en la tabla
                      if(isset($_POST['nombre']) &amp;&amp; isset($_POST['dni']) &amp;&amp;  isset($_POST['tipo_de_alumno'])){
              //en esta linea se ponen los nombres de los campos separados por comas y en la parte de values lo mismo pero con variables $_POST['nombre_campo']
              //se reinician las variables de la busqueda
              unset($result2);
              unset($row2);

              //rellena la sql para buscar las asignaturas
              $sql2="Select * from tipos_de_alumno;";
              //echo $sql2;
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //echo $result2;
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              //busca que id tiene la asignatura
              DO
              {
              //si el nombre coincide con el elegido en el formulario coge el nombre y el id de la asignatura
              if($row2['id_tipo_de_alumno']==$_POST['tipo_de_alumno']){
                      //echo "hemos entrao!!";
                      $nombre_asig=$row2['nombre'];
                      //echo $nombre_asig;
                      $id_tipo_de_alumno=$row2['id_tipo_de_alumno'];
                      //echo $id_asig;
                      break;
              }
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));             
              $sql="INSERT INTO `alumnos` ( `id` , `nombre` , `dni`, `id_tipo_de_alumno` )
                              VALUES (NULL , '".$_POST['nombre']."' , '".$_POST['dni']."', '".$id_tipo_de_alumno."');";
                              //echo $sql;
              //se ejecuta la inserción de datos
                              $result=mysql_query($sql,$conexion);
              //se informa de que se añadido un nuevo alumno
                              echo "&lt;p&gt;Alumno Añadido&lt;/p&gt;";
              //se coloca el enlace que permite volver al listado
                              echo "&lt;p&gt;&lt;A HREF='index.php'&gt;Volver&lt;/A&gt;&lt;/p&gt;";
                      }else{
              // si no nos han metido campos
                              echo "&lt;p&gt;Vuelva a intentarlo&lt;/p&gt;";
              // se vuelve a colocar el formulario con los mismos campos que ahora, la diferenia es que se pone tantas veces como campos haya en los VALUE el $_POST['nombre_de_campo'] para que no haya que volver a teclearlo
                      
                      echo "&lt;form method=\"post\" action=\"nuevo.php?id=".$_GET['id']."\"&gt;";
              //aqui se deben poner tantas líneas echo como campos haya
              //cambiando el echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength=200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_campo\" maxlength=longitud_campo size=tamaño_caja_texto&gt;&lt;br&gt;";
              // se muestra la caja del nombre del alumno
                              echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength =100 size=40&gt;&lt;br&gt;";
              // se muestra la caja del dni del alumno
                              echo "DNI : &lt;input type=\"text\" name=\"nombre\" maxlength =15 size=9&gt;&lt;br&gt;";
              //inicia la combo de los tipos
              echo "&lt;select name=\"tipo_de_alumno\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from tipos_de_alumno;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option value=\"".$row2['id_tipo_de_alumno']."\"&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más tipos de alumno
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas tipos de alumno cierra el listado
              echo "&lt;/select&gt; &lt;br&gt;&lt;br&gt;";
              ////se coloca el botón de guardar
                      echo "&lt;input type=\"submit\" name=\"nuevo\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
                      }
              }
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>Cabe destacar la segúnda búsqueda
      en la tabla de tipos de alumno para ocnstuir el tag select
      (combobox)</p><p>matricular.php alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");
          //rellenamos la consulta, cambiar alumnos por el nombre de la tabla a listar
          $sql="Select * from alumnos WHERE id=".$_GET['id'].";";
          //print $sql;
          //re realiza la consulta
          $result=mysql_query($sql,$conexion);
          //mete el alumno en la variable $row
          $row= mysql_fetch_array($result);

          //print $sql2;
          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Matricular
              Alumno:&lt;?php echo $row['nombre']; ?&gt;&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              //comprueba si se entas enviando datos para guardar
              //si no es asi es que tiene que presentar el formulario
              if(!isset( $_POST['nuevo']))
              {
              //coloca el principio del formulario para que vuelva al mismo script cuando se rellene
                      echo "&lt;form method=\"post\" action=\"matricular.php?id=".$_GET['id']."\"&gt;";
              //aqui se deben poner tantas líneas echo como campos haya
              //cambiando el echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength=200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_campo\" maxlength=longitud_campo size=tamaño_caja_texto&gt;&lt;br&gt;";
              //se muestra el código del alumno
              echo "&lt;p&gt;Código:".$row["id"]."&lt;/p&gt;";
              //se muestra el nombre del alumno
              echo "&lt;p&gt;Nombre:".$row["nombre"]."&lt;/p&gt;";
                      
              //se coloca la caja oculta con el id del alumno
                      echo "&lt;input type=\"hidden\" name=\"id_alum\" value=\"".$row['id']."\"&gt;";
              //inicia la combo de las asignaturas
              echo "&lt;select name=\"asignatura\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from asignaturas;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option value=\"".$row2['id']."\"&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas asignatutas cierra el listado de asignaturas
              echo "&lt;/select&gt; &lt;br&gt;&lt;br&gt;";
              ////se coloca el botón de guardar
                      echo "&lt;input type=\"submit\" name=\"nuevo\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
              }else{
              //si se han metido los datos en el formulario
              //se deben colocar tantos isset($_POST['nombre_campo']) &amp;&amp; como campos haya en la tabla
                      if(isset($_POST['id_alum']) &amp;&amp; isset($_POST['asignatura'])){

              //se reinician las variables de la busqueda
              unset($result2);
              unset($row2);

              //rellena la sql para buscar las asignaturas
              $sql2="Select * from asignaturas;";
              //echo $sql2;
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //echo $result2;
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              //busca que id tiene la asignatura
              DO
              {
              //si el nombre coincide con el elegido en el formulario coge el nombre y el id de la asignatura
              if($row2['id']==$_POST['asignatura']){
                      //echo "hemos entrao!!";
                      $nombre_asig=$row2['nombre'];
                      //echo $nombre_asig;
                      $id_asig=$row2['id'];
                      //echo $id_asig;
                      break;
              }
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));


                              $sql="INSERT INTO `matriculas` ( `id_mat` , `id_alum` , `id_asig` )
                              VALUES (NULL , ".$_POST['id_alum']." , ".$_POST['asignatura'].")";
                              //echo $sql;
              //se ejecuta la inserción de datos
                              $result=mysql_query($sql,$conexion);
              //se informa de que se añadido un nuevo alumno
                              echo "&lt;p&gt;Matrícula añadida del alumno ".$row['nombre']." en la asignatura ".$nombre_asig."&lt;/p&gt;";
              //se coloca el enlace que permite volver al listado
                              echo "&lt;p&gt;&lt;A HREF='ver_matriculas.php?id=".$_GET['id']."'&gt;Volver&lt;/A&gt;&lt;/p&gt;";
                      }else{
              // si no nos han metido campos
                              echo "&lt;p&gt;Vuelva a intentarlo&lt;/p&gt;";
              // se vuelve a colocar el formulario con los mismos campos que ahora, la diferenia es que se pone tantas veces como campos haya en los VALUE el $_POST['nombre_de_campo'] para que no haya que volver a teclearlo
                      echo "&lt;form method=\"post\" action=\"matricular.php\"&gt;";
              //aqui se deben poner tantas líneas echo como campos haya
              //cambiando el echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength=200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_campo\" maxlength=longitud_campo size=tamaño_caja_texto&gt;&lt;br&gt;";
              //se muestra el código del alumno
              echo "&lt;p&gt;Código:".$row["id"]."&lt;/p&gt;";
              //se muestra el nombre del alumno
              echo "&lt;p&gt;Nombre:".$row["nombre"]."&lt;/p&gt;";
                      
              //se coloca la caja oculta con el id del alumno
                      echo "id : &lt;input type=\"hidden\" name=\"id_alum\" value=\"".$row['id']."\"&gt;&lt;br&gt;";
              //inicia la combo de las signaturas
              echo "&lt;select name=\"asignatura\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from asignaturas;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas asignatutas cierra el listado de asignaturas
              echo "&lt;/select&gt; ";
              ////se coloca el botón de guardar
                      echo "&lt;input type=\"submit\" name=\"nuevo\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
                      }
              }
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>Este es un caso un poco peculiar, ya que dado un alumno
      se le intenta matricular en alguna de las asignaturas
      disponibles. Por lo tanto debe buscar todas las asignaturas y
      colocarlas en el select. Y luego hacer la
      insercción en la tabla de relaciones
      (matriculas).</p><p>ver_matriculas.php alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");
          //rellenamos la consulta, cambiar alumnos por el nombre de la tabla a listar
          $sql="Select * from alumnos WHERE id=".$_GET['id'].";";
          //print $sql;
          //re realiza la consulta
          $result=mysql_query($sql,$conexion);
          //mete el alumno en la variable $row
          $row= mysql_fetch_array($result);

          //print $sql2;
          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Matricular
              Alumno:&lt;?php echo $row['nombre']; ?&gt;&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              //comprueba si se entas enviando datos para guardar
              //si no es asi es que tiene que presentar el formulario
              if(!isset( $_POST['nuevo']))
              {
              //coloca el principio del formulario para que vuelva al mismo script cuando se rellene
                      echo "&lt;form method=\"post\" action=\"matricular.php?id=".$_GET['id']."\"&gt;";
              //aqui se deben poner tantas líneas echo como campos haya
              //cambiando el echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength=200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_campo\" maxlength=longitud_campo size=tamaño_caja_texto&gt;&lt;br&gt;";
              //se muestra el código del alumno
              echo "&lt;p&gt;Código:".$row["id"]."&lt;/p&gt;";
              //se muestra el nombre del alumno
              echo "&lt;p&gt;Nombre:".$row["nombre"]."&lt;/p&gt;";
                      
              //se coloca la caja oculta con el id del alumno
                      echo "&lt;input type=\"hidden\" name=\"id_alum\" value=\"".$row['id']."\"&gt;";
              //inicia la combo de las asignaturas
              echo "&lt;select name=\"asignatura\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from asignaturas;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option value=\"".$row2['id']."\"&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas asignatutas cierra el listado de asignaturas
              echo "&lt;/select&gt; &lt;br&gt;&lt;br&gt;";
              ////se coloca el botón de guardar
                      echo "&lt;input type=\"submit\" name=\"nuevo\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
              }else{
              //si se han metido los datos en el formulario
              //se deben colocar tantos isset($_POST['nombre_campo']) &amp;&amp; como campos haya en la tabla
                      if(isset($_POST['id_alum']) &amp;&amp; isset($_POST['asignatura'])){

              //se reinician las variables de la busqueda
              unset($result2);
              unset($row2);

              //rellena la sql para buscar las asignaturas
              $sql2="Select * from asignaturas;";
              //echo $sql2;
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //echo $result2;
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              //busca que id tiene la asignatura
              DO
              {
              //si el nombre coincide con el elegido en el formulario coge el nombre y el id de la asignatura
              if($row2['id']==$_POST['asignatura']){
                      //echo "hemos entrao!!";
                      $nombre_asig=$row2['nombre'];
                      //echo $nombre_asig;
                      $id_asig=$row2['id'];
                      //echo $id_asig;
                      break;
              }
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));


                              $sql="INSERT INTO `matriculas` ( `id_mat` , `id_alum` , `id_asig` )
                              VALUES (NULL , ".$_POST['id_alum']." , ".$_POST['asignatura'].")";
                              //echo $sql;
              //se ejecuta la inserción de datos
                              $result=mysql_query($sql,$conexion);
              //se informa de que se añadido un nuevo alumno
                              echo "&lt;p&gt;Matrícula añadida del alumno ".$row['nombre']." en la asignatura ".$nombre_asig."&lt;/p&gt;";
              //se coloca el enlace que permite volver al listado
                              echo "&lt;p&gt;&lt;A HREF='ver_matriculas.php?id=".$_GET['id']."'&gt;Volver&lt;/A&gt;&lt;/p&gt;";
                      }else{
              // si no nos han metido campos
                              echo "&lt;p&gt;Vuelva a intentarlo&lt;/p&gt;";
              // se vuelve a colocar el formulario con los mismos campos que ahora, la diferenia es que se pone tantas veces como campos haya en los VALUE el $_POST['nombre_de_campo'] para que no haya que volver a teclearlo
                      echo "&lt;form method=\"post\" action=\"matricular.php\"&gt;";
              //aqui se deben poner tantas líneas echo como campos haya
              //cambiando el echo "Nombre : &lt;input type=\"text\" name=\"nombre\" maxlength=200 size=40&gt;&lt;br&gt;";
              // por echo "Nombre : &lt;input type=\"text\" name=\"nombre_campo\" maxlength=longitud_campo size=tamaño_caja_texto&gt;&lt;br&gt;";
              //se muestra el código del alumno
              echo "&lt;p&gt;Código:".$row["id"]."&lt;/p&gt;";
              //se muestra el nombre del alumno
              echo "&lt;p&gt;Nombre:".$row["nombre"]."&lt;/p&gt;";
                      
              //se coloca la caja oculta con el id del alumno
                      echo "id : &lt;input type=\"hidden\" name=\"id_alum\" value=\"".$row['id']."\"&gt;&lt;br&gt;";
              //inicia la combo de las signaturas
              echo "&lt;select name=\"asignatura\"&gt;";
              //rellena la sql para buscar las asignaturas
              $sql2="Select * from asignaturas;";
              //re realiza la consulta para meter en $result2 las asignaturas
              $result2=mysql_query($sql2,$conexion);
              //coloca en $row2 la primera asignatura
              $row2= mysql_fetch_array($result2);
              DO
              {
              //coloca la asignatura en el listado
              echo "&lt;option&gt;".$row2['nombre']."&lt;/option&gt;";
              }
              //comprueba si hay más asignaturas
              while ($row2= mysql_fetch_array($result2));
              //si no hay mas asignatutas cierra el listado de asignaturas
              echo "&lt;/select&gt; ";
              ////se coloca el botón de guardar
                      echo "&lt;input type=\"submit\" name=\"nuevo\" value=\"Guardar\"&gt;&lt;/form&gt;&lt;br&gt;";
                      }
              }
              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div><p>borrar_matricula.php alumnos</p><div class="informalexample"><pre class="programlisting">
          &lt;?php 
          //incluimos el fichero config.php para coger los datos de la conexión
          include_once('../config.php');
          //cogemos las variables de las coneción para que se puedan utilizar en el script
          global $server, $database, $user, $passwd;
          //abrimos la conexión
          $conexion = mysql_connect($server,$user,$passwd);
          //elegimos la BBDD
          mysql_select_db ($database, $conexion) OR die ("No se puede conectar");
          //rellenamos la consulta, cambiar alumnos por el nombre de la tabla a listar
          $sql="Select * from matriculas WHERE id_mat=".$_GET['id'].";";
          //re realiza la consulta
          $result=mysql_query($sql,$conexion);
          //print $sql;
          //se coge el registro del alumno
          $row= mysql_fetch_array($result);
          ?&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;TITLE&gt;Borrar Alumno&lt;/TITLE&gt;
              &lt;LINK REL="stylesheet" TYPE="text/css"
              HREF="../estilo.css" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;?php
              // se rellena la consulta que borra el alumno se substituye alumno por el nombre de la tabla 
              $sql="DELETE from `matriculas` WHERE `id_mat` =".$_GET['id']." LIMIT 1 ;";
              //echo $sql;
              // se ejecuta la consulta se borrado
              $result=mysql_query($sql,$conexion);
              // se informa de que se ha eliminado un alumno
              echo "&lt;p&gt;Matrícula eliminada&lt;/p&gt;";
              // se coloca el enlace que permite volver al listado
              echo "&lt;p&gt;&lt;A HREF='ver_matriculas.php?id=".$_GET['id_alum']."'&gt;Volver&lt;/A&gt;&lt;/p&gt;";

              ?&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03.html">Anterior</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch04s02.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Capítulo 3. Otros ejemplos </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Conclusiones</td></tr></table></div></body></html>
