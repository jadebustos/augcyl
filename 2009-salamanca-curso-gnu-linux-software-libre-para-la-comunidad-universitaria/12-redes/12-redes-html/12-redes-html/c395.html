<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Redes Privadas Virtuales (VPN)</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GNU/Linux, software libre para la comunidad universitaria"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Acceso remoto seguro"
HREF="c362.html"><LINK
REL="NEXT"
TITLE="IPsec"
HREF="x430.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GNU/Linux, software libre para la comunidad universitaria: Redes privadas virtuales en GNU/Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c362.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x430.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="AEN395"
></A
>CapÌtulo 6. Redes Privadas Virtuales (VPN)</H1
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN397"
>6.1. Soluciones VPN para GNU/Linux</A
></H1
><P
>VPN es el acr√≥nimo en ingl√©s de red privada virtual. El objetivo es lograr, mediante la creaci√≥n de un t√∫nel IP cifrado sobre una red p√∫blica como Internet, que los nodos a conectar por la VPN virtualmente est√©n en una misma red local. Es posible establecer una VPN directamente entre dos nodos, pero lo m√°s habitual es o bien una VPN entre un nodo remoto y la red local de la empresa (esta configuraci√≥n en ingl√©s se llama con frecuencia road warrior, guerrero de la carretera, hace menci√≥n a que un usuario m√≥vil se conecta a la empresa con su port√°til y una conexi√≥n a Internet desde all√≠ d√≥nde est√° desplazado) o una VPN que une dos redes, por ejemplo dos filiales de una empresa o una filial con la central.</P
><P
>Hay distintas tecnolog√≠as y productos para crear una VPN con implementaciones libres para GNU/LInux: </P
><P
></P
><OL
TYPE="1"
><LI
><P
>IPsec: el est√°ndar por excelencia, ser√° obligatorio en IPv6 y est√° implementado en muchas pilas TCP/IP tambi√©n para la actual generaci√≥n IPv4, incluyendo el kernel Linux. Se implementa directamente sobre la capa 3 (IP) mientras que el resto de soluciones suelen implementarse a nivel de capa de aplicaci√≥n (aunque conceptualmente PPTP y L2TP son protocolos de capa de datos, se implementan como t√∫neles, en el caso de L2TP s√≠ es sobre UDP, en el caso de PPTP se usa GRE, que es un protocolo sobre IP). A diferencia de otras soluciones que se implementan siempre mediante un t√∫nel, IPsec permite tanto t√∫neles (modo t√∫nel, entre dos security gateways, SG) como directamente cifrar la capa de transporte (modo transporte), lo que es √∫til cuando s√≥lo se quiere seguridad entre dos m√°quinas o ya se implementa el t√∫nel sobre una capa posterior (t√≠picamente la de aplicaci√≥n, utilizando paquetes UDP, es el caso que enseguida veremos de L2TP sobre IPsec).</P
></LI
><LI
><P
>PPTP: protocolo impulsado por Microsoft. Su implementaci√≥n original ten√≠a varios fallos graves y adem√°s existe el problema de que no est√° tan probado como IPsec siendo tambi√©n relativamente compleja. No es un est√°ndar, aunque se public√≥ un RFC informativo describiendo el protocolo. El nombre completo es Point to Point Tunneling Protocol. Hay clientes de PPTP en Windows desde Windows 95, aunque Microsoft trata ahora de substituir PPTP por LLTP e IPsec, si bien PPTP ha tenido cierto √©xito por su sencillez de configurar: no se usan claves p√∫blicas, sino las propias cuentas de Windows para autenticar el acceso. </P
><P
>Hay implementaciones para GNU/Linux interoperables con la implementaci√≥n de Microsoft tanto del cliente (<A
HREF="http://pptpclient.sourceforge.net/"
TARGET="_top"
>http://pptpclient.sourceforge.net/</A
>) como del servidor (<A
HREF="http://pptpclient.sourceforge.net/"
TARGET="_top"
>http://pptpclient.sourceforge.net/</A
>) . A destacar que los desarrolladores de estas implementaciones recomiendan no usar PPTP m√°s que si no queda otro remedio: en su lugar recomienda OpenVPN o IPsec.</P
><P
>En Ubuntu 7.10, el cliente PPTP forma parte de los paquetes oficiales. Hay adem√°s un applet para network-manager, aunque este ya no es oficial.</P
></LI
><LI
><P
>L2TP: Layer 2 Tunnel Protocol: promovido por Microsoft y CISCO, sigue la v√≠a de estandarizaci√≥n del IETF (es el RFC2661, con la versi√≥n 3 m√°s reciente en el RFC 3931). Es un protocolo que crea un t√∫nel a nivel de la capa de aplicaci√≥n (mediante paquetes UDP, aunque en principio puede encapsularse sobre otro tipos de redes no IP) para transportar tr√°pico layer2. Mediante L2TP se crea un t√∫nel entre el LAC (L2TP Access Concetrator) y el LNS (L2TP Network Server): una vez creado el t√∫nel, cualquiera de las dos partes puede abrir sesiones (tambi√©n denominadas en L2TP como llamadas)  y estas sesiones se multiplexar√°n sobre el t√∫nel; un uso t√≠pico es crear una sesi√≥n PPP. L2TP garantiza fiabilidad en los paquetes de control, mientras que en los de datos como es propio de UDP podr√°n perderse. Podemos pensar en el LAC como la parte cliente de la VPN, aunque hay una configuraci√≥n, compulsory tunnel remote dial en que no es as√≠; para ser m√°s precisos normalmente funciona siendo el software al que se conecta el cliente PPP para que la encapsule en un t√∫nel L2TP, en algunas implementaciones en realidad el cliente PPP y el LAC se implementan con un solo programa, pero hay configuraciones en las que el LAC lo implementa el ISP y otro caso t√≠pico es que lo implemente un router en la red local. En este caso el ordenador del usuario no tiene que saber nada de L2TP, sino que utiliza por ejemplo PPPoE para conectarse con el router o con el ISP, estando ese tramo sin cifrar.</P
><P
>En realidad L2TP no implementa por s√≠ s√≥lo una VPN, dado que no cifra la informaci√≥n, por lo que o bien usa PPTP o lo recomendado, usa IPsec (es decir, se establece un transporte seguro entre los dos extremos y a su vez se encapsula el t√∫nel L2TP: esto tambi√©n se estandariza por el IETF, en el RFC ).</P
><P
>¬øQu√© sentido tiene usar L2TP sobre IPsec, pudiendo usar directamente IPsec? una raz√≥n es usar la autenticaci√≥n PPP (por ejemplo un servidor Radius) y la parte de autoconfiguraci√≥n (por ejemplo proporcionar la informaci√≥n DNS); no obstante con IPsec tambi√©n es posible autenticaci√≥n y asignar IP y DNS sin necesidad de L2TP. As√≠ mismo L2TP crea un t√∫nel a nivel 2, por lo que puede ir todo tipo de tr√°fico, no necesariamente IP, por ejemplo puede ir tr√°fico IPX o incluso se puede transportar directamente paquetes de nivel 2 como ATM. As√≠ mismo L2TP en gran medida es m√°s interesante para proveedores de Internet que tengan que encapsular informaci√≥n (por ejemplo puede multiplexar varias sesiones L2TP sobre un t√∫nel L2TP/IPsec, o aprovechar esta funcionalidad para revender ancho de banda), que para VPNs entre oficinas, pero en cualquier caso se agradece que haya implementaciones para GNU/Linux pues habr√° servidores que no permitan conectarse directamente usando IPsec (quiz√°s por desear usar la autenticaci√≥n PPP) y requieran L2TP. En concreto usan L2TP adem√°s de Microsoft, CISCO y MacOSX . En el art√≠culo de la Wikipedia hay enlaces a las implementaciones existentes as√≠ como a un tutorial: <A
HREF="http://en.wikipedia.org/wiki/L2TP"
TARGET="_top"
>http://en.wikipedia.org/wiki/L2TP</A
>. Tambi√©n se comenta la dificultad con Windows de usar IPsec sin L2TP.
</P
></LI
><LI
><P
>OpenVPN: es la soluci√≥n recomendada, por su sencillez: hace un t√∫nel TLS sobre el que se encapsulan paquetes layer 3 (IP) o layer 2 (Ethernet), pero usando UDP en lugar de TCP, aunque tambi√©n se puede usar sobre TCP e incluso pasar a trav√©s de proxies HTTP. En realidad TLS no se puede implementar directamente sobre UDP, porque requiere un protocolo fiable como TCP y con UDP se tiene que permitir la p√©rdida de paquetes. Por ello en realidad TLS se usa para la funcionalidad de control, como negociar la sesi√≥n TLS o renegociarla en un momento dado (implementando sobre UDP un sistema para pedir de nuevo los paquetes que se puedan perder y son importantes por ser de control), sustituyendo a los protocolos PKI de IPsec. Pero adem√°s se han imitado los mecanismos presentes en las cabeceras <A
NAME="AEN417"
HREF="#FTN.AEN417"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
> de IPsec para dar seguridad a nivel de paquete y con independencia de si se pierde el paquete anterior: para ello hay que a√±adir una secuencia a los paquetes, as√≠ como un HMAC y contemplar varios mecanismos. Una idea similar es la que se sigue en la implementaci√≥n del est√°ndar DTLS (Datagram TLS: <A
HREF="http://es.wikipedia.org/wiki/Datagram_Transport_Layer_Security"
TARGET="_top"
>http://es.wikipedia.org/wiki/Datagram_Transport_Layer_Security</A
>) que se define en el RFC4347 y cuya √∫nica implementaci√≥n actual conocida es la que hace el proyecto OpenSSL. En <A
HREF="http://unix.freshmeat.net/projects/dtls_example/"
TARGET="_top"
>http://unix.freshmeat.net/projects/dtls_example/</A
> hay c√≥digo de ejemplo. Es posible que en un futuro se modifique OpenVPN para usar DTLS en lugar de su propio protocolo.</P
></LI
><LI
><P
>Montar una VPN sobre la marcha con OpenSSH y pppd o OpenSSH con TUN. Es una soluci√≥n de compromiso ante una necesidad puntual. Si hemos instalado SSH y dejamos que pase el cortafuegos por si necesitamos conectarnos o lo usamos para cifrar un tunel con la conexi√≥n el acceso a escritorio remoto, en un momento dado podemos instalar una VPN. La idea es utilizar el software de PPP (pppd) para crear los dispositivos de red en cada extremo y comunicarlos por un t√∫nel SSH: el software PPP escribe por salida est√°ndar lo que lee del dispositivo de red e igualmente lo que lee por salida est√°ndar lo pone en el dispositivo de red. Con SSH se pueden comunicar las entradas salidas de dos programas, formando un t√∫nel. Si lo preferimos, podemos hacer el t√∫nel utilizando Stunnel en lugar de OpenSSH. Otra opci√≥n es utilizar la opci√≥n de hacer un t√∫nel con TUN de SSH. Una ventaja es que es algo m√°s sencillo, se puede lanzar sin privilegios y existe TUN incluso para Windows, aunque no por ejemplo para Mac OS X. Otra ventaja es que se puede usar TAP en lugar de TUN y usarlo para hacer un bridge: pppd necesita parchearse para funcionar en un bridge (soporte BCP), pues no transmite tramas Ethernet, sino por defecto tramas IP (aunque en Linux puede transmitir IPX en lugar de IP). Otra utilidad que puede hacer el papel de openssh +TUN pero m√°s ligera es socat (la mencionamos al hablar de netcat). Socat es una utilidad realmente vers√°til que tambi√©n puede reemplazar a stunnel.</P
></LI
><LI
><P
>Usar un cliente sobre la VPN proporcionada por un encaminador CISCO. El cliente, al igual que OpenVPN, no necesita de ning√∫n soporte en el k√©rnel. salvo TUN/TAP. Web: <A
HREF="http://www.unix-ag.uni-kl.de/~massar/vpnc/"
TARGET="_top"
>www.unix-ag.uni-kl.de/~massar/vpnc/</A
>
</P
></LI
><LI
><P
>En grandes empresas, usar la infraestructura de VPN que ofrezca el operador para unir dos sedes (no es por tanto soluci√≥n general para teletrabajo, especialmente si no tiene por qu√© coincidir el operador), de modo que se tiene una red privada virtual como si se tuviera una l√≠nea dedicada o una conexi√≥n dedicada a trav√©s de una red de conmutaci√≥n de circuitos como las l√≠neas telef√≥nicas anal√≥gicas. T√≠picamente esto es posible si el operador utiliza MPLS, u otras tecnolog√≠as m√°s antiguas como ATM o Frame Relay. Obviamente, requiere que el operador comercialice la posibilidad de conectar dos sedes entre s√≠ en lugar de s√≥lo dar servicio a Internet.</P
></LI
></OL
><P
>El paquete NetworkManager (<A
HREF="http://www.gnome.org/projects/NetworkManager/"
TARGET="_top"
>www.gnome.org/projects/NetworkManager/</A
>) dispone de plugins para OpenVPN, PPTP y VPNC (para este √∫ltimo programa soporta los ficheros .pcf, que ser√≠a lo √∫nico que tendr√≠a que distribuir el administrador). En el caso de la versi√≥n incluida en Ubuntu 7.10, s√≥lo aparece la opci√≥n de configurar VPN si la tarjeta est√° en modo "itinerante", lo que excluye la configuraci√≥n manual.</P
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notas</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN417"
HREF="c395.html#AEN417"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>IPsec define dos protocolos para dar seguridad a los paquetes, AH y ESP. AH garantiza la integridad y previene replay attacks, mientras que ESP adem√°s de eso cifra. AH garantiza la integridad tambi√©n de las cabeceras (por lo que no puede usarse con NAT), pero en general no es muy √∫til para una VPN frente a ESP, pues normalmente IPsec se usa en modo t√∫nel, no en modo transporte, y en este caso las Ips origen y destino van dentro del paquete. No obstante s√≠ podr√≠a ser √∫til para que los routers est√©n seguros que el tr√°fico proviene de determinado router, suponiendo que se use un certificado que reconozcan y que efectivamente los "secure gateway", es decir, los extremos del t√∫nel, coincidan con los enrutadores. En modo transporte sin AH la IP de origen se puede falsificar. En modo t√∫nel se podr√≠a falsificar la direcci√≥n del router origen o destino entre los que se establece la VPN, pero no las IP origen y destino de los paquetes, que es lo que importa a los usuarios finales. Si se desea, se puede encapsular ESP en un paquete AH, pero rara vez se hace. Bruce Schneier recomienda simplificar IPsec y eliminar el modo de transporte y AH. dejando s√≥lo ESP y modo t√∫nel.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c362.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x430.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Acceso remoto seguro</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>IPsec</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>