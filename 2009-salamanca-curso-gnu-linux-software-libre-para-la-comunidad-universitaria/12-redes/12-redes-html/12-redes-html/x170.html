<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Capa de transporte (Layer4)</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GNU/Linux, software libre para la comunidad universitaria"
HREF="index.html"><LINK
REL="UP"
TITLE="Paquetes de red. Modelo en Capas"
HREF="c49.html"><LINK
REL="PREVIOUS"
TITLE="Capa de red: capa IP (Layer3)"
HREF="x110.html"><LINK
REL="NEXT"
TITLE="Capa de aplicaci칩n (Layer5; Layer7 en OSI)"
HREF="x199.html"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GNU/Linux, software libre para la comunidad universitaria: Redes privadas virtuales en GNU/Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x110.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Cap狎ulo 2. Paquetes de red. Modelo en Capas</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x199.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN170"
>2.3. Capa de transporte (Layer4)</A
></H1
><P
>Sobre los datagramas IP va la capa de transporte. Aqu칤 hay distintos tipos de protocolos, los m치s famosos son los TCP (que usan casi todas las aplicaciones) los UDP (que se usan para el DNS y para aplicaciones como streaming de v칤deo o para construir los t칰neles de las VPNs). </P
><P
>Hay m치s tipos de protocolos de transporte que UDP y TCP: DDCP, SCTP... Tambi칠n est치n implementados en GNU/Linux pero no lo est치n en todos los sistemas operativos. Hay que se침alar as칤 mismo que protocolos como ICMP e IGMP, as칤 como distintos protocolos de enrutamiento, aunque sean posibles protocolos dentro de un paquete IP como TCP y UDP no son protocolos de transporte sino de red. </P
><P
>Nos centraremos pues en la distinci칩n entre UDP y TCP. TCP es un protocolo orientado a la conexi칩n. Esto quiere decir que con TCP todos los paquetes que pertenecen a una conexi칩n se numeran (el n칰mero de secuencia inicial se genera aleatoriamente para dificultar ataques de seguridad de falsificar una conexi칩n) y se garantiza que llegan todos a destino y en el orden en que se enviaron. Al comienzo de la conexi칩n, el primer paquete TCP lleva un flaq indicando que se quiere establecer una conexi칩n. El protocolo TCP incluye mecanismos para confirmar la recepci칩n de los paquetes (los paquetes que no se confirmen que se han recibido hay que volverlos a enviar) as칤 como mecanismos de control de congesti칩n (detectar que se est치n enviando m치s paquetes de los que permite el ancho de banda de la conexi칩n y en ese caso bajar el ritmo).</P
><P
>UDP en cambio es un protocolo sin conexi칩n. Cada paquete es independiente de los dem치s. No hay ninguna garant칤a de que el programa llegue a su destino, ya sea porque hay errores o porque la red est치 saturada: si estamos saturando la red y por eso no llegan los paquetes nos tendremos que dar cuenta nosotros y tomar las medidas oportunas (bajar el ritmo de env칤o). As칤 mismo no hay garant칤a que los paquetes que lleguen lo hagan en el mismo orden en que se enviaron, dado que los paquetes IP pueden ir por rutas distintas.</P
><P
>쯈u칠 aporta entonces la capa de transporte UDP sobre lo que proporciona la capa de red IP? 쯣or qu칠 no enviar los datos directamente como datagramas IP en lugar de como paquetes UDP? El gran aporte de UDP, que tambi칠n forma parte de TCP, es que adem치s de incluir IP de origen y destino, incluye puerto origen y destino. El puerto destino es 칰til para poder ejecutar varios servicios en la misma m치quina: por ejemplo en el puerto 80 puede estar el servidor web y en el 25 el servidor de correo. Podemos ver al puerto destino como una extensi칩n y a la IP como un tel칠fono. El puerto origen tambi칠n es muy 칰til: cuando el cliente env칤a un paquete elige un puerto origen libre y gracias a este puerto el servidor puede distinguir, a la hora de responder, entre dos conexiones procedentes de la misma IP.</P
><P
>Por lo que hemos visto, TCP garantiza fiabilidad en la conexi칩n mientras que con UDP si se quiere enviar una secuencia de paquetes todo se complica todo y adem치s no hay garant칤a de que no se pierdan los paquetes. 쯈u칠 sentido tiene usar entonces UDP? Para la mayor칤a de los protocolos de aplicaci칩n, ninguno: la mayor칤a requieren un canal de transporte orientado a la comunicaci칩n (que dicho sea de paso, podr칤a ser TCP o cualquier otro actual como sockets UNIX o que se cree en el futuro, el API de programaci칩n de Unix es independiente del protocolo concreto que est칠 por debajo). Hay casos, sin embargo, en que UDP es 칰til:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Cuando se trata de un env칤o simple, de un 칰nico paquete y se espera otro paquete de respuesta. Aqu칤 no es problema que el paquete se pierda: si el servidor no responde, se vuelve a enviar la petici칩n. Con UDP s칩lo se env칤a dos paquetes (el de petici칩n y el de respuesta), mientras que con TCP se env칤an varios paquetes para primero establecer la conexi칩n y luego para cerrarla, adem치s de implicar reservar/liberar recursos para el control de la conexi칩n. Un ejemplo son las consultas DNS, o el uso de BOOTP/DHCP (en el caso de DHCP cuenta adem치s que UDP es m치s f치cil de implementar que TCP y puede que la petici칩n BOOTP se haga desde un gestor de arranque o la ROM de arranque de una tarjeta de red, por lo que a칰n no hay sistema operativo. </P
></LI
><LI
><P
>Cuando no pasa nada porque se pierdan paquetes, pero lo fundamental es que los paquetes que lleguen lo hagan a tiempo, no perdiendo el tiempo en retransmisiones, confirmaciones y control de congesti칩n. Es el caso de streaming de v칤deo o la VoIP (voz sobre IP). Otro caso son protocolos de sincronizaci칩n. </P
></LI
><LI
><P
>Cuando se usa el protocolo de transporte para hacer de t칰nel transportando otros paquetes, por ejemplo para implementar una VPN. Por un lado est치 que si transporta paquetes de v칤deo con UDP porque lo fundamental es que lleguen muchos paquetes a tiempo aunque algunos se pierdan, si usamos TCP por debajo UDP ya no tiene ninguna ventaja: llegar치n todos los paquetes, pero algunos demasiado tarde, m치s tarde de lo que hubieran llegado si no hubiera TCP por debajo. Con los paquetes TCP estar칤amos innecesariamente aplicando dos veces el control de errores, de congesti칩n, de que llegan los paquetes ordenados... TCP est치 dise침ado para ir sobre IP, no sobre TCP; sobre UDP tambi칠n est치 bien porque s칩lo a침ade unas cabeceras, principalmente para los puertos. Es m치s, los algoritmos de control de congesti칩n de TCP tienen un indeseable efecto multiplicador cuando se aplican sobre una conexi칩n que ya va sobre TCP, que se traduce en que tarda m치s en coger velocidad. Ocurre sobre todo sobre medios f칤sicos propensos a errores, como Wifi. El motivo es que cuando por culpa de un error se pierde un paquete, los algoritmos de congesti칩n lo atribuyen a que se est치 transmitiendo a demasiada velocidad, por lo que reducen el ritmo de env칤o de paquetes, con lo que la aplicaci칩n que crea los paquetes TCP percibe que hay congesti칩n, pero adem치s una severa, pues suele disminuirse la velocidad a la mitad.</P
></LI
><LI
><P
>Cuando la existencia de NAT en los dos extremos es un problema (conexi칩n cliente a cliente). Con UDP, el enrutador que hace NAT sabe que los paquetes que reciba con destino al puerto origen son paquetes de respuesta y debe dejarlos pasar, no hay propiamente un cliente y un servidor: con TCP esto es m치s complicado al entrar en juego el flag syn y los n칰meros de secuencia, por lo que en la pr치ctica es mucho m치s dif칤cil lograr que dos m치quinas tras NAT logren una conexi칩n TCP que UDP.</P
></LI
></OL
><P
>El protocolo de transporte DCCP ofrece como TCP control de congesti칩n, pero al igual que UDP no garantiza que todos los paquetes se entreguen ni que lleguen en orden. B치sicamente es 칰til para los mismos casos que UDP, pero con la ventaja de no tener que implementar en la capa de la aplicaci칩n el control de congesti칩n. Al estar poco extendido no obstante hoy en d칤a no encontraremos ning칰n programa conocido que use este protocolo.</P
><P
>El protocolo de transporte SCTP ofrece las mismas caracter칤sticas que TCP, pero adem치s ofrece algunas ventajas (con todo apenas se usa, en Windows no est치 implementado por Microsoft y hace falta instalar software de terceros, pero es especialmente 칰til para usar con SIP, por ejemplo <A
HREF="http://sofia-sip.sourceforge.net/"
TARGET="_top"
>http://sofia-sip.sourceforge.net/</A
>):</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Multistreaming: permite transportar sobre un 칰nico canal varios streams, que se tratar치n independientemente en temas como garantizar el orden de recepci칩n de los paquetes (incluso a nivel de stream se puede desactivar el tema del orden si no es necesario). Esta caracter칤stica es muy 칰til para trasmitir la se침alizaci칩n de la VoIP de varias llamadas, de hecho SCTP se cre칩 para transmitir SS7 (se침alizaci칩n n칰mero 7).</P
></LI
><LI
><P
>Multihoming: en los extremos puede haber m치s de una interfaz, esto permite por ejemplo usar a la vez dos Ethernet o pasar de una Ethernet a una Wifi sin interrumpir la conexi칩n.</P
></LI
><LI
><P
>Mantiene l칤mites de los mensajes: con SCTP si se escribe un mensaje de 100 bytes al leer en el otro extremo se leen 100 bytes; con TCP esto no est치 garantizado.</P
></LI
><LI
><P
>mecanismos para evitar ataques syn flood; tambi칠n elimina problemas en cierres de conexiones que presenta TCP.</P
></LI
></OL
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x110.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x199.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Capa de red: capa IP (Layer3)</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c49.html"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Capa de aplicaci칩n (Layer5; Layer7 en OSI)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>