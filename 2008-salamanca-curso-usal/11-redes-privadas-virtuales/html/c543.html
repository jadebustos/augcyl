<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Escritorio remoto</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GNU/Linux, software libre para la comunidad universitaria"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="OpenVPN"
HREF="x485.html"><LINK
REL="NEXT"
TITLE="Escritorio remoto: RFB (VNC)"
HREF="x572.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GNU/Linux, software libre para la comunidad universitaria: Redes privadas virtuales en GNU/Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x485.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x572.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="AEN543"
></A
>Cap狎ulo 7. Escritorio remoto</H1
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN545"
>7.1. Escritorio remoto: X-Window</A
></H1
><P
>El sistema X-Window desde sus or칤genes se dise침칩 con vistas a la transparencia de red: una aplicaci칩n se visualiza y maneja desde un terminal, pero puede estar ejecut치ndose en cualquier m치quina de la red con la que haya conexi칩n TCP/IP. En la terminolog칤a X-Window, el PC del usuario ejecuta el servidor X, mientras que las aplicaciones son los clientes: la idea es que las aplicaciones hacen peticiones al servidor del tipo dibuja este mapa de bits o notificam칠 determinados eventos. El servidor notifica a los clientes eventos como pulsaciones de teclas o eventos del rat칩n.</P
><P
>Para ejecutar una aplicaci칩n desde una m치quina remota a la que nos hemos conectado por ejemplo a trav칠s de un telnet o un ssh, lo primero que hace falta es que est칠 definida la variable DISPLAY, que indica el servidor a utilizar. As칤, un valor :0 indica usar el servidor local (si hubiera m치s de uno, se incrementar칤a el n칰mero); con el valor 192.168.7.10:0, indicar칤amos que conecte con el servidor X de la m치quina 192.168.7.10.</P
><P
>El siguiente requisito, es que si la conexi칩n es v칤a red, tiene que estar abierto en el cortafuegos el puerto TCP del servidor X. Este puerto por defecto es 6000 para el primer servidor (:0) y se va incrementando conforme se ejecutan m치s servidores sobre una misma m치quina.</P
><P
>Finalmente, el servidor X tiene que permitir que el cliente se conecte. Hay dos formas:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>m칠todo poco sutil, xhost. Ejecutando xhost desde nuestro servidor X damos permiso para que desde las Ips que indiquemos se puedan conectar a nuestro servidor. As칤, con xhost +192.168.7.1 permitir칤amos conectar desde esa IP. Con xhost + permitir칤amos conectar desde cualquier IP. Ojo, no conceder este permiso con ligereza: un cliente puede espiar eventos de teclado, enviar eventos de teclado (nada divertido si tenemos una terminal abierta y env칤an un comando destructivo seguido de l evento de la tecla enter) o cuanto menos molestar bastante. A esto hay que a침adir que al abrir una IP se abren a todos los posibles usuarios de la m치quina si es multiusuario o al posible malware que tuviera instalado; as칤 mismo no hay que olvidar la posibilidad del IP Spoofing.</P
></LI
><LI
><P
>m칠todo m치s adecuado, xauth. Para que el cliente pueda conectarse, salvo que se haya permitido expl칤citamente utilizando xhost como se describe en el m칠todo anterior, tiene que utilizar una "cookie" que est치 almacenada en la cuenta de usuario del servidor que ejecuta el servidor X-Window, en el fichero que indique la variable de entorno XAUTHORITY. Este es el motivo por el que en algunas distribuciones al cambiar de usuario, incluso al cambiar a root, no permite ejecutar aplicaciones X: la variable de entorno ya no apunta a este fichero, por lo que no se env칤a la cookie. Hay distribuciones en las que s칤 funciona al pasar a root, porque sudo, su o la orden que hayamos ejecutado para cambiar de usuario usa un m칩dulo PAM para que al establecer una nueva sesi칩n de usuario se copie la cookie. Como comentario adicional, con xhost es posible dar permiso para que abra conexiones cualquier cliente local con independencia de su usuario, pero no clientes remotos, mediante xhost +local:. Este mecanismo se apoya en que cuando cliente (aplicaci칩n) y servidor (terminal X) est치n en la misma m치quina, no usan el socket TCP sino un socket Unix, que es s칩lo accesible localmente. De hecho si s칩lo vamos a permitir conexiones locales, es buena idea ejecutar el servidor X con la opci칩n -nolisten tcp; es lo que hacen por defecto distribuciones como Ubuntu.</P
></LI
></OL
><P
>Mediante la herramienta xauth, podemos leer la cookie en el servidor X; luego tambi칠n mediante la herramienta xauth, en la m치quina remota, podemos a침adir la cookie.</P
><P
>En realidad, el m칠todo recomendado para ejecutar aplicaciones remotas es conectarnos con ssh con la opci칩n -X o con la opci칩n -Y<A
NAME="AEN558"
HREF="#FTN.AEN558"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
> (si recibi칠ramos alg칰n -Y estamos sujetos a algunas restricciones de seguridad, a decir verdad no totalmente efectivas). Al ejecutar aplicaciones a trav칠s de SSH se usa para cada conexi칩n un t칰nel encapsulado dentro de la conexi칩n SSH, con todas las ventajas que implica: seguridad, al estar cifrado y protegido contra modificaci칩n y versatibilidad, pues no hay que abrir ning칰n puerto en el cortafuegos ni hay problema si nuestra m치quina est치 tras una ADSL con NAT. La idea en que se basa es utilizar un proxy: crea un servidor X en la m치quina remota y redirige todo lo que recibe por medio del t칰nel SSH al servidor X real que tenemos en nuestra m치quina local. Gracias a este sistema funciona incluso aunque el servidor X se ejecute con la opci칩n -nolisten tcp, pues la comunicaci칩n es local gracias al t칰nel.</P
><P
>Muchas veces la forma de ejecutar las aplicaciones remotas no es ejecutando aplicaciones sueltas, en nuestro escritorio local, sino ejecutando entero el escritorio remoto. Es decir, nos sale la pantalla de GDM o KDM que nos pide nuestro usuario y contrase침a y a continuaci칩n entramos en un escritorio Gnome o KDE, pero que en realidad no es el de nuestra m치quina, sino el de una m치quina remota. Esta funcionalidad se apoya en el protocolo XDMCP, que por razones de seguridad suele estar desactivado (lo implementa el propio GDM/KDM). El protocolo usa el puerto UDP 177, pero s칩lo inicialmente; para mostrar la propia pantalla de Login ya recurre a la habitual conexi칩n TCP con el puerto 6000, si bien autom치ticamente configura todo, incluyendo el fichero con la cookie, para que el usuario no tenga que hacer nada especial. Se puede establecer una conexi칩n con un servidor XDMCP bien directamente desde el gdm de la m치quina local, o pasando opciones como -query (ver man Xserver) a un servidor X ejecutado en otra consola, por ejemplo <KBD
CLASS="userinput"
>X :1 -query 192.168.10.7</KBD
> o bien a un servidor ejecutando en una ventana, como xnest o el m치s moderno Xephyr . En cualquier caso usar XDMCP es inseguro, habr칤a que tener un t칰nel que proteja tanto la conexi칩n UDP con el servidor XDMCP, como las conexiones TCP de los clientes X-Window. Una opci칩n m치s sencilla de lograr una sesi칩n sin perder seguridad, sobre todo teniendo en cuenta que openssh no permite t칰neles UDP, es olvidarse de XDMCP e invocar en la m치quina remota v칤a SSH por ejemplo /etc/X11/Xsession<A
NAME="AEN562"
HREF="#FTN.AEN562"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
> (te칩ricamente podr칤a valer con ejecutar x-session-manager, pero suelen arrancarse aparte algunos demonios, como D-BUS).</P
><P
>Hay servidores X libres disponibles tambi칠n para Windows: recomendamos <A
HREF="http://x.cygwin.com/"
TARGET="_top"
>http://x.cygwin.com/</A
>. </P
><P
>X-Window es la tecnolog칤a pionera de escritorio remoto, pero con el tiempo han surgido otras como RFB (VNC), RDP, Citrix, Adaptive Internet Protocol (Sun), Tarantella, </P
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notas</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN558"
HREF="c543.html#AEN558"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>La opci칩n -X ejecuta usando un modo restringido de seguridad, que impide por ejemplo acceder a determinadas propiedades y que puede impedir que algunas aplicaciones de escritorio se ejecuten. Las restricciones de seguridad que impone -X tampoco son demasiado efectivas por s칤 solas. Si al usar ssh con -X o con -Y, en la m치quina remota no aparece definida la variable de entorno DISPLAY y por lo tanto no funcionan las aplicaciones X, posiblemente se deba a que en la m치quina remota no est치 instalado xauth.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN562"
HREF="c543.html#AEN562"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Por ejemplo, desde una consola se puede lanzar <KBD
CLASS="userinput"
>startx /usr/bin/xterm -- :1</KBD
> y luego desde ese terminal (que no debe cerrarse o de lo contrario se cerrar치 la sesi칩n) ejecutar <KBD
CLASS="userinput"
>ssh -Y user@host /etc/X11/Xsession</KBD
>. Con Xephyr la idea ser칤a primero crear una cookie de autenticaci칩n invocando xauth; en la subshell hay que ejecutar una orden tipo <KBD
CLASS="userinput"
>add :1 . ad753146ead4c2e60031c60f22139da9f</KBD
> (:1 ser칤a el DISPLAY) y para grabar salir con exit. A continuaci칩n se puede lanzar el servidor, por ejemplo con <KBD
CLASS="userinput"
>Xephyr :1 -auth .Xauthority &#38;</KBD
>, finalmente se establece <KBD
CLASS="userinput"
>export DISPLAY=:1</KBD
> y se invoca ssh.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x485.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x572.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>OpenVPN</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Escritorio remoto: RFB (VNC)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>