<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Cuotas en ext2/ext3</title><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"><link rel="start" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="up" href="ch04.html" title="Capítulo 4. Sistemas de Ficheros"><link rel="prev" href="ch04s10.html" title="Obtención de información sobre los sistemas de ficheros"><link rel="next" href="ch04s12.html" title="Atributos en sistemas de ficheros ext2/ext3"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Cuotas en <span class="emphasis"><em>ext2/ext3</em></span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s10.html">Anterior</a> </td><th width="60%" align="center">Capítulo 4. Sistemas de Ficheros</th><td width="20%" align="right"> <a accesskey="n" href="ch04s12.html">Siguiente</a></td></tr></table><hr></div><div class="sect1" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2550688"></a>Cuotas en <span class="emphasis"><em>ext2/ext3</em></span></h2></div></div></div><p>Es posible establecer cuotas de espacio en disco tanto por usuario como por grupo para evitar que un determinado usuario o grupo monopolice el espacio en disco.</p><p>Esta característica tiene que estar soportada dentro del núcleo.</p><p>El espacio en disco es un recurso finito y una mala gestión de su uso puede provocar una denegación de servicio.</p><p>Será necesario controlar la actividad de los usuarios para evitar un mal uso del espacio en disco.</p><p>Aunque el espacio en disco pueda parecer asequible a los usuarios en realidad es bastante caro. Ya que el tener espacio desaprovechado implica:</p><div class="itemizedlist"><ul type="disc"><li><p>Un mayor coste en tiempo y recursos de almacenamiento debido a las políticas de backup.</p></li><li><p>Un mayor coste en tiempo a la hora de restaurar backups.</p></li><li><p>Hoy en día el espacio en disco se suele asignar en <span class="emphasis"><em>SAN</em></span> debido a su verstilidad. El uso de tecnologías <span class="emphasis"><em>SAN</em></span> es de un alto coste.</p></li></ul></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2550757"></a>¿En qué sistemas de ficheros podemos establecer cuotas de usuario?</h3></div></div></div><p>Podemos establecer cuotas de espacio en disco en todos los sistemas de ficheros que aparezcan en <code class="filename">/etc/fstab</code>.</p><p>Debido a la posibilidad de realizar una instalación en varios sistemas de ficheros podemos optimizar el uso de cuotas para los usuarios y grupos en cada sistema de fichero.</p></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2550782"></a>Cuotas <span class="emphasis"><em>hard</em></span></h3></div></div></div><p>Las cuotas <span class="emphasis"><em>hard</em></span> establecen la cantidad máxima de espacio que se puede utilizar y no se pueden sobrepasar a menos que el administrador las cambie. Estas cuotas se pueden establecer:</p><div class="itemizedlist"><ul type="disc"><li><p>Por usuario. Una vez superado el usuario no podrá escribir en el sistema de ficheros.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p>Al contrario que en otros sistemas un usuario que haya sobrepasado la cuota sí podrá borrar ficheros.</p></div></li><li><p>Por grupo. Una vez superado ningún usuario del grupo podrá escribir en el sistema de ficheros, a pesar de que no haya alcanzado su cuota como usuario.</p></li></ul></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2550829"></a>Cuotas <span class="emphasis"><em>soft</em></span></h3></div></div></div><p>Las cuotas <span class="emphasis"><em>soft</em></span> establen el umbral para avisar a los usuarios o grupos de que están llegando al límite máximo o <span class="emphasis"><em>cuota hard</em></span>. Cuando se llega a esta cuota cada vez que un usuario que la ha sobrepasado escribe en el sistema de ficheros le aparece un mensaje en la terminal recordandoselo. Estas cuotas se pueden establecer:</p><div class="itemizedlist"><ul type="disc"><li><p>Por usuario.</p></li><li><p>Por grupo.</p></li></ul></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2550872"></a>El periodo de gracia</h3></div></div></div><p>Cuando se sobrepasa la <span class="emphasis"><em>cuota soft</em></span> se entra en el <span class="emphasis"><em>periodo de gracia</em></span>. Una vez terminado el periodo no le es permitido al usuario o grupo escribir en el sistema de ficheros hasta que libere el espacio necesario para estar por debajo de la <span class="emphasis"><em>cuota soft</em></span>.</p><p>Este periodo se puede especificar en meses, semanas, dís, horas, minutos o segundos.</p></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2550901"></a>Pasos previos a la activación de las cuotas</h3></div></div></div><p>Será necesario que el núcleo este activado con soporte para cuotas.</p><p>Como se podría esperar sólo es <span class="emphasis"><em>superusuario</em></span> o <span class="emphasis"><em>root</em></span> podrá establecer las cuotas.</p><p>Para cada sistema de ficheros en el que queramos establecer las cuotas deberemos hacer lo siguiente:</p><div class="orderedlist"><ol type="1"><li><p>Añadir en el fichero <code class="filename">/etc/fstab</code> las opciones <span class="emphasis"><em>usrquota</em></span> para habilitar las cuotas para usuarios y <span class="emphasis"><em>grpquota</em></span> para los grupos.</p></li><li><p>Crear los ficheros <code class="filename">quota.user</code> y <code class="filename">quota.group</code> en la raíz del sistema de ficheros y establecer los permisos adecuados. Supongamos que queremos establecer las cuotas de usuario y grupo para el sistema de ficheros <span class="emphasis"><em>/dev/sda5</em></span> que está montado en <code class="filename">/home</code>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>touch /home/quota.user</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>touch /home/quota.group</code></strong>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>chmod 400 /home/quota.*</code></strong>
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>Estos ficheros contendran datos binarios y no texto.</p></div></li><li><p>Tendremos que inicializar las bases de datos que van a almacenar la información relativa a las cuotas en los ficheros que hemos creado anteriormente:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>quotacheck -avug</code></strong>
<code class="computeroutput">quotacheck: Scanning /dev/sda5 [/home] done
quotacheck: Checked 79 directories and 657 files</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Las opciones que le hemos pasado a <span><strong class="command">quotacheck</strong></span>:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>a</em></span> realiza la comprobación para todos los sistemas de ficheros con cuotas.</p></li><li><p><span class="emphasis"><em>v</em></span> modo verbose.</p></li><li><p><span class="emphasis"><em>u</em></span> realiza la comprobación para las cuotas de usuario.</p></li><li><p><span class="emphasis"><em>g</em></span> realiza la comprobación para las cuotas de grupo.</p></li></ul></div></li><li><p>Activamos el sistema de quotas:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>quotaon -a</code></strong>
<code class="prompt">[root@sal]# </code>
</pre></li></ol></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2551149"></a>Estableciendo cuotas</h3></div></div></div><p>Una vez configurado y arrancado el sistema de cuotas tendremos que establecer las cuotas para los diferentes usuarios y grupos.</p><p>Las cuotas se establecen por bloques e inodos. A menos que se haya jugueteado con las opciones la crear un sistema de ficheros cada bloque equivaldráa, normalmente, a 1 KB (1.24 bytes).</p><p>Utilizaremos el comando <span><strong class="command">edquota</strong></span> para establecer las cuotas. Este comando accede a los ficheros <code class="filename">quota.user</code> y <code class="filename">quota.group</code> creando un fichero temporal en <code class="filename">/tmp</code> editandolo por defecto con <span class="emphasis"><em>vi</em></span> a menos que se especifique otro editor en las variables de entorno <span class="emphasis"><em>EDITOR</em></span> o <span class="emphasis"><em>VISUAL</em></span>. Algunos de los flags que podemos utilizar son:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>u</em></span> que se utiliza para editar las cuotas de disco de los usuarios. Si se especifica la opción <span class="emphasis"><em>g</em></span> esta opción es ignorada.</p></li><li><p><span class="emphasis"><em>g</em></span> que se utiliza para editar las cuotas de disco de los grupos.</p></li></ul></div><p>Para cambiar las cuotas del usuario <span class="emphasis"><em>pcm</em></span> deberemos:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>edquotacheck -u pcm</code></strong>
</pre><p>A continuación se accederá a los ficheros de cuotas y se creará en <code class="filename">/tmp</code> un fichero con datos que será editado y aparecerá algo como esto:</p><pre class="programlisting">
Disk quotas for user pcm (uid 1000):
Filesystem     blocks   soft   hard   inodes   soft   hard
/dev/sda5        1084  15000  25000      732   2000   3500
</pre><p>Modificamos los valores para <span class="emphasis"><em>hard</em></span> y <span class="emphasis"><em>soft</em></span> y al grabar y salir se actualiza el sistema de cuotas con los nuevos datos.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>Los valores que aparecen en <span class="emphasis"><em>blocks</em></span> y en <span class="emphasis"><em>inodes</em></span> son los bloques e inodos que está utilizando el usuario en ese sistema de ficheros en ese momento.</p></div><p>Es posible establecer cuotas de usuario en línea de comando utilizando el comando <span><strong class="command">setquota</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p><span><strong class="command">man setquota</strong></span></p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2551326"></a>Estableciendo el periodo de gracia</h3></div></div></div><p>El periodo de gracia lo estableceremos con <span><strong class="command">edquota -t</strong></span>. El procedimiento es el mismo que para establecer las cuotas de usuarios y grupos con <span><strong class="command">edquota</strong></span>. Al ejecutar <span><strong class="command">edquota -t</strong></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>edquota -t</code></strong>
<code class="computeroutput">Grace period before enforcing soft limits for users:
Time units may be: days, hours, minutes, or seconds
Filesystem       Block grace period   Inode grace period
/dev/sda5        7days                7 days</code>
</pre><p>Podemos establecer el periodo de gracia pro bloques o por inodos. Lo establecemos según nuestras necesidades y al salir grabando se actualizan las BBDD del sistema con los nuevos datos.</p></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2551388"></a>Iniciando y parando el sistema de cuotas</h3></div></div></div><p>Una vez que hemos configurado los sistemas de ficheros sobre los cuales tendremos cuotas y hemos establecido dichas cuotas tendremos que arrancar el sistema de cuotas:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>quotaon -av</code></strong>
<code class="computeroutput">/dev/sda5 [/home]: group quotas turned on
/dev/sda5 [/home]: user quotas turned on</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Los flags más habituales son:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>a</em></span> que inicializa las cuotas en todos los sistemas de ficheros que las tienen activadas.</p></li><li><p><span class="emphasis"><em>v</em></span> modo verbose.</p></li><li><p><span class="emphasis"><em>u</em></span> unicamente inicializa las cuotas de usuario.</p></li><li><p><span class="emphasis"><em>g</em></span> unicamente inicializa las cuotas de grupo.</p></li></ul></div><p>Es posible inicializar las cuotas sobre un determinado sistema de ficheros:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>quotaon -v /opt</code></strong>
<code class="computeroutput">/dev/sda6 [/opt]: group quotas turned on
/dev/sda6 [/opt]: user quotas turned on</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Podemos parar el sistema de cuotas con el comando <span><strong class="command">quotaoff</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p><span><strong class="command">man quotaoff</strong></span></p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2551526"></a>Chequeando el sistema de cuotas</h3></div></div></div><p>Utilizaremos para ello el comando <span><strong class="command">quotacheck</strong></span>. Este comando se utiliza para chequear y actualizar el uso de espacio en disco en los sistemas de ficheros y para repar los ficheros de cuotas <code class="filename">quota.user</code> y <code class="filename">quota.group</code>.</p><p>Por defecto sólo se comprueban las cuotas de usuario, si se quieren comprobar las de grupo habrá que utilizar <span class="emphasis"><em>g</em></span>.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Aviso</h3><p>Cuando se chequeen las cuotas de disco es recomendable hacerlo con el sistema de cuotas parado.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Aviso</h3><p>Es aconsejable que cuando se arranque el sistema se comprueben los sistemas de ficheros con cuotas antes de inicializar el sistema de cuotas.</p></div><p>Los flags más habituales son:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>a</em></span> comprueba todos los sistemas de ficheros montados con cuotas establecidas.</p></li><li><p><span class="emphasis"><em>g</em></span> comprueba las cuotas de grupo. No se comprueban a menos que se use este flag.</p></li><li><p><span class="emphasis"><em>i</em></span> trabaja en modo interactivo.</p></li><li><p><span class="emphasis"><em>u</em></span> comprueba las cuotas de usuario. Acción por defecto.</p></li><li><p><span class="emphasis"><em>v</em></span> modo verbose. Es aconsejable utilizar este flag.</p></li></ul></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2551634"></a>Reporting de cuotas</h3></div></div></div><p>Mediante el uso de <span><strong class="command">repquota</strong></span> es posible obtener informes sobre el estado de las cuotas del sistema. Los flags más significativos son:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>a</em></span> informe sobre todos los sistemas de ficheros con cuotas presentes en <code class="filename">/etc/fstab</code>.</p></li><li><p><span class="emphasis"><em>g</em></span> informe sobre las cuotas de grupo.</p></li><li><p><span class="emphasis"><em>u</em></span> informe sobre las cuotas de usuario.</p></li></ul></div><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>repquota -a</code></strong>
<code class="computeroutput">*** Report for user quotas on device /dev/sda5
Block grace time: 7days; Inode grace time: 7days
                  Block limits                  File limits
User       used   soft   hard   grace    used    soft   hard   grace
--------------------------------------------------------------------
root   --    20      0      0               4       0      0
pcm -- 10848  15000  25000             732    2000   3500</code>
<code class="prompt">[root@sal]# </code>
</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p>Es posible sacar informes sobre un único sistema de ficheros pasandole el punto de montaje o el dispositivo físico como argumento a <span><strong class="command">repquota</strong></span>.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s10.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s12.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Obtención de información sobre los sistemas de ficheros </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Atributos en sistemas de ficheros <span class="emphasis"><em>ext2/ext3</em></span></td></tr></table></div></body></html>
