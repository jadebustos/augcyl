<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Particiones lógicas (logical volumes)</title><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"><link rel="start" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="up" href="ch05.html" title="Capítulo 5. Gestión de sistemas de ficheros mediante LVM"><link rel="prev" href="ch05s02.html" title="Grupos de volumen (volume groups)"><link rel="next" href="ch06.html" title="Capítulo 6. Introducción al uso de SAN en GNU/Linux"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Particiones lógicas (logical volumes)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s02.html">Anterior</a> </td><th width="60%" align="center">Capítulo 5. Gestión de sistemas de ficheros mediante <span class="emphasis"><em>LVM</em></span></th><td width="20%" align="right"> <a accesskey="n" href="ch06.html">Siguiente</a></td></tr></table><hr></div><div class="sect1" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2558001"></a>Particiones lógicas (logical volumes)</h2></div></div></div><p>Las particiones lógicas son particiones que se crean dentro de un volume group y podrán crecer siempre y cuando hay espacio libre dentro del grupo de volumen.</p><p>Una partición lógica se crea:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvcreate -L5G -n mysql_lv /dev/data_vg</code></strong>
<code class="computeroutput">  Logical volume "mysql_lv" created</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Habremos creado una partición lógica de 5 gigas en el grupo de volumen <span class="emphasis"><em>data_vg</em></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p>Para formatearla, montarla, ... nos referiremos a ella como <code class="filename">/dev/data_vg/mysql_lv</code>.</p></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2558063"></a>Información y detección de particiones lógicas</h3></div></div></div><p>Podemos utilizar el comando <span><strong class="command">lvscan</strong></span> para encontrar particiones lógicas:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvscan</code></strong>
<code class="computeroutput">  ACTIVE            '/dev/data_vg/apache_lv' [20,00 GB] inherit
  ACTIVE            '/dev/data_vg/mysql_lv' [20,00 GB] inherit</code>
<code class="prompt">[root@sal]# </code>
</pre><p>También disponemos del comando <span><strong class="command">lvdisplay</strong></span> que nos ofrece más información sobre las particiones lógicas encontradas:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvdisplay</code></strong>
<code class="computeroutput">  --- Logical volume ---
  LV Name                /dev/data_vg/apache_lv
  VG Name                data_vg
  LV UUID                KCDc3t-jAHj-dNDK-I9qe-rF3B-oyya-Tg00JL
  LV Write Access        read/write
  LV Status              available
  # open                 1
  LV Size                20,00 GB
  Current LE             5120
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           253:0

  --- Logical volume ---
  LV Name                /dev/data_vg/mysql_lv
  VG Name                data_vg
  LV UUID                0m24gV-H9BC-MdbV-vSNZ-r57x-gx37-zUy22q
  LV Write Access        read/write
  LV Status              available
  # open                 0
  LV Size                20,00 GB
  Current LE             5120
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           253:1</code>
<code class="prompt">[root@sal]# </code>
</pre><p>El comando <span><strong class="command">lvs</strong></span> también nos ofrece información:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvs</code></strong>
<code class="computeroutput">  LV        VG      Attr   LSize  Origin Snap%  Move Log Copy%
  apache_lv data_vg -wi-ao 20,00G
  mysql_lv  data_vg -wi-a- 20,00G</code>
<code class="prompt">[root@sal]# </code>
</pre></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2558203"></a>Ampliación de una partición lógica</h3></div></div></div><p></p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvextend -L+2G /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">  Extending logical volume mysql_lv to 7,00 GB
  Logical volume mysql_lv successfully resized</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Una vez ampliada la partición lógica habrá que hacer un resize. Si es sistema de ficheros es <span class="emphasis"><em>ReiserFS</em></span> podemos hacerlo en caliente sin desmontarlo:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>resize_reiserfs /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">  resize_reiserfs 3.6.19 (2003 www.namesys.com)
  

  resize_reiserfs: On-line resize finished successfully.</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Con <span class="emphasis"><em>ext3</em></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>ext2online /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">ext2online v1.1.18 - 2001/03/18 for EXT2FS 0.5b</code>
<code class="prompt">[root@sal]# </code>
</pre></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2558318"></a>Reducción de tamaño para particiones lógicas</h3></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Aviso</h3><p>Antes de reducir un sistema de ficheros es MUY recomendable asegurarse de que hay un backup de los datos.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Aviso</h3><p>Si el sistema de ficheros está fragmentado y existen datos en la parte a reducir esos datos se perderán.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Aviso</h3><p>Cuando reduzcamos un sistema de ficheros tenemos que asegurarnos de que el sistema de ficheros resultante puede contener todos los datos.</p></div><p>Los pasos a seguir son:</p><div class="itemizedlist"><ul type="disc"><li><p>Desmontar la partición.</p></li><li><p>Hacer un resize del sistema de ficheros al tamaño deseado.</p><p>Con un sistema de ficheros <span class="emphasis"><em>ReiserFS</em></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>resize_reiserfs -s -1G /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">Dando formato a resize_reiserfs(8); aguarde, por favor...
telemaco:/media# resize_reiserfs -s -1G /dev/data_vg/mysql_lv 
resize_reiserfs 3.6.19 (2003 www.namesys.com)

You are running BETA version of reiserfs shrinker.
This version is only for testing or VERY CAREFUL use.
Backup of you data is recommended.

Do you want to continue? [y/N]:<strong class="userinput"><code>y</code></strong>
Processing the tree: 0%....20%....40%....60%....80%....100%                      left 0, 105322 /sec

nodes processed (moved):
int        3 (0),
leaves     209 (0),
unfm       210432 (0),
total      210644 (0).

check for used blocks in truncated region

ReiserFS report:
blocksize             4096
block count           1048576 (1310720)
free blocks           829690 (1091826)
bitmap block count    32 (40)

Syncing..done


resize_reiserfs: Resizing finished successfully.</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Con un sistema de ficheros <span class="emphasis"><em>ext3</em></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>e2fsck -f /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">e2fsck 1.35 (28-Feb-2004)
Paso 1: revisando nodos i, bloques y tamaños
Paso 2: revisando la estructura de directorios
Paso 3: revisando la conectividad del directorio.
Paso 4: revisando las cuentas de referencia
Paso 5: revisando el resumen de información del grupo
/dev/data_vg/mysql_lv: ficheros 11/92160 (9.1% no contiguos), bloques 7156/179200</code>
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>resize2fs /dev/data_vg/mysql_lv 6g</code></strong>
<code class="computeroutput">resize2fs 1.35 (28-Feb-2004)
Resizing the filesystem on /dev/data_vg/mysql_lv to 2816000 (4k) blocks.
El sistema de ficheros en /dev/data_vg/mysql_lv mide ahora 2816000 bloques.</code>
</pre></li><li><p>Reducimos la partición lógica:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvreduce -L-1G /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">  WARNING: Reducing active logical volume to 6,00 GB
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce mysql_lv? [y/n] <strong class="userinput"><code>y</code></strong>
  Logical volume mysql_lv successfully resized</code>
<code class="prompt">[root@sal]# </code>
</pre></li></ul></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2558520"></a>Activación y desactivación de particiones lógicas</h3></div></div></div><p>Para determinadas operaciones de los grupos de volumen es necesario desactivar las particiones lógicas que en ellos residen.</p><p>Utilizaremos para ello el comando <span><strong class="command">lvchange</strong></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvchange -a n /dev/data_vg/mysql_lv</code></strong>
<code class="prompt">[root@sal]# </code>
</pre><p>Desactivaría la partición lógica.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Sugerencia</h3><p><span><strong class="command">man lvchange</strong></span></p></div></div><div class="sect2" lang="es"><div class="titlepage"><div><div><h3 class="title"><a name="id2558577"></a>Eliminación de una partición lógica</h3></div></div></div><p>Para eliminar una partición lógica utilizaremos el comando <span><strong class="command">lvremove</strong></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>lvremove /dev/data_vg/mysql_lv</code></strong>
<code class="computeroutput">Do you really want to remove active logical volume "mysql_lv"? [y/n]: <strong class="userinput"><code>y</code></strong>
  Logical volume "mysql_lv" successfully removed</code>
<code class="prompt">[root@sal]# </code>
</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s02.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch05.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch06.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Grupos de volumen (volume groups) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Capítulo 6. Introducción al uso de <span class="emphasis"><em>SAN</em></span> en GNU/Linux</td></tr></table></div></body></html>
