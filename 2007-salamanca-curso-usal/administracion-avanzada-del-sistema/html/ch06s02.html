<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Escaneado de discos</title><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"><link rel="start" href="index.html" title="Utilización y Administración avanzada de sistemas GNU/Linux y aplicaciones Software Libre para estudiantes universitarios"><link rel="up" href="ch06.html" title="Capítulo 6. Introducción al uso de SAN en GNU/Linux"><link rel="prev" href="ch06.html" title="Capítulo 6. Introducción al uso de SAN en GNU/Linux"><link rel="next" href="ch06s03.html" title="Dispositivos virtuales"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Escaneado de discos</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06.html">Anterior</a> </td><th width="60%" align="center">Capítulo 6. Introducción al uso de <span class="emphasis"><em>SAN</em></span> en GNU/Linux</th><td width="20%" align="right"> <a accesskey="n" href="ch06s03.html">Siguiente</a></td></tr></table><hr></div><div class="sect1" lang="es"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2560414"></a>Escaneado de discos</h2></div></div></div><p>Cada vez que necesitemos disco es posible asignarle disco a un servidor y añadirselo sin reiniciarlo.</p><p>Para añadir los discos será necesario hacerlo de dos pasos:</p><div class="orderedlist"><ol type="1"><li><p>Reescaneo del bus <span class="emphasis"><em>SCSI</em></span>.</p><p>En el caso de tarjetas <span class="emphasis"><em>Qlogic 2340</em></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>echo "scsi-qlascan" &gt; /proc/scsi/qla2300/1</code></strong>
<code class="prompt">[root@sal]# </code>
</pre><p>Tendremos que hacer esto para cada tarjeta a la que se haya asignado el disco. Las tarjetas serán nombradas con un número dentro de <code class="filename">/proc/scsi/qla2300/</code>.</p><p>Una vez hecho esto el sistema SCSI verá los discos pero será necesario registrarlos en el sistema para asignarles un dispositivo:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>cat /proc/scsi/qla2300/1</code></strong>
<code class="computeroutput">QLogic PCI to Fibre Channel Host Adapter for QLA2340:
        Firmware version:  3.02.13, Driver version 6.06.00
Entry address = ce800060
HBA: QLA2312 , Serial# P19322
Request Queue = 0xe8ec000, Response Queue = 0xe8d0000
Request Queue count= 128, Response Queue count= 512
Total number of active commands = 0
Total number of interrupts = 12
Total number of IOCBs (used/max) = (0/600)
Total number of queued commands = 0
    Device queue depth = 0x20
Number of free request entries = 127
Number of mailbox timeouts = 0
Number of ISP aborts = 0
Number of loop resyncs = 0
Number of retries for empty slots = 0
Number of reqs in pending_q= 0, retry_q= 0, done_q= 0, scsi_retry_q= 0
Host adapter:loop state= &lt;READY&gt;, flags= 0x8e0813
Dpc flags = 0x0
MBX flags = 0x0
SRB Free Count = 4096
Link down Timeout = 000
Port down retry = 030
Login retry count = 030
Commands retried with dropped frame(s) = 0


SCSI Device Information:
scsi-qla0-adapter-node=200000e08b17da2e;
scsi-qla0-adapter-port=210000e08b17da2e;
scsi-qla0-target-0=5005076300c4a585;
scsi-qla0-target-1=5005076300c3a585;
scsi-qla0-target-2=5005076300c2a585;
scsi-qla0-target-3=5005076300cca585;
scsi-qla0-target-4=5005076300cba585;
scsi-qla0-target-5=5005076300caa585;

SCSI LUN Information:
(Id:Lun)  * - indicates lun is not registered with the OS.
( 0: 0): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:81,
( 0: 1): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:81,
( 0: 2): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:81,
( 1: 0): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:82,
( 1: 1): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:82,
( 1: 2): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:82,
( 2: 0): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:83,
( 2: 1): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:83,
( 2: 2): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:83,
( 3: 0): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:84,
( 3: 1): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:84,
( 3: 2): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:84,
( 4: 0): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:85,
( 4: 1): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:85,
( 4: 2): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:85,
( 5: 0): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:86,
( 5: 1): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:86,
( 5: 2): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:86,</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Aquellos dispositivos en los que aparezca <span class="emphasis"><em>flags 0x0*</em></span>, el asterisco nos da la clave, son los dispositivos nuevos que se han asignado y para los que necesitaremos registrar en el sistema para asignarles un dispositivo en <code class="filename">/dev/</code>.</p><p>En el caso de tarjetas <span class="emphasis"><em>Qlogic 2462</em></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>echo 1 &gt; /sys/class/fc_host/host1/issue_lip</code></strong>
<code class="prompt">[root@sal]# </code>
</pre><p>Tendremos que hacer esto para cada tarjeta a la que se haya asignado el disco. Las tarjetas serán nombradas con host<span class="emphasis"><em>n</em></span>.</p><p>Una vez hecho esto el sistema SCSI verá los discos pero será necesario registrarlos en el sistema para asignarles un dispositivo:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>cat /proc/scsi/qla2xxx/1</code></strong>
<code class="computeroutput">QLogic PCI to Fibre Channel Host Adapter for QMC2462S:
        Firmware version 4.00.18 [IP] , Driver version 8.01.04-d7
ISP: ISP2422
Request Queue = 0x7cc00000, Response Queue = 0x7d3c0000
Request Queue count = 4096, Response Queue count = 512
Total number of active commands = 28
Total number of interrupts = 15416672
    Device queue depth = 0x20
Number of free request entries = 4067
Number of mailbox timeouts = 0
Number of ISP aborts = 0
Number of loop resyncs = 0
Number of retries for empty slots = 0
Number of reqs in pending_q= 0, retry_q= 0, done_q= 0, scsi_retry_q= 0
Host adapter:loop state = &lt;READY&gt;, flags = 0x1e03
Dpc flags = 0x4000000
MBX flags = 0x0
Link down Timeout = 030
Port down retry = 030
Login retry count = 030
Commands retried with dropped frame(s) = 0
Product ID = 0000 0000 0000 0000


SCSI Device Information:
scsi-qla0-adapter-node=200000e08b859383;
scsi-qla0-adapter-port=210000e08b859383;
scsi-qla0-target-0=5006016030224a8b;
scsi-qla0-target-1=5006016930224a8b;

FC Port Information:
scsi-qla0-port-0=50060160b0224a8b:5006016030224a8b:010000:81;
scsi-qla0-port-1=50060160b0224a8b:5006016930224a8b:010400:82;

SCSI LUN Information:
(Id:Lun)  * - indicates lun is not registered with the OS.
( 0: 0): Total reqs 256853, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 1): Total reqs 8896695, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 2): Total reqs 8524762, Pending reqs 28, flags 0x0, 0:0:81 00
( 0: 3): Total reqs 216957, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 4): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:81 00
( 0: 5): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:81 00
( 0: 6): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:81 00
( 1: 0): Total reqs 14430, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 1): Total reqs 14442, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 2): Total reqs 14463, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 3): Total reqs 14399, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 4): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:82 00
( 1: 5): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:82 00
( 1: 6): Total reqs 0, Pending reqs 0, flags 0x0*, 0:0:82 00</code>
<code class="prompt">[root@sal]# </code>
</pre><p>Aquellos dispositivos en los que aparezca <span class="emphasis"><em>flags 0x0*</em></span>, el asterisco nos da la clave, son los dispositivos nuevos que se han asignado y para los que necesitaremos registrar en el sistema para asignarles un dispositivo en <code class="filename">/dev/</code>.</p><p>Tendremos que hacer esto para cada tarjeta a la que se haya asignado el disco. Las tarjetas serán nombradas como host<span class="emphasis"><em>n</em></span>.</p><p>Una vez hecho esto el sistema SCSI verá los discos pero será necesario registrarlos en el sistema para asignarles un dispositivo.</p></li><li><p>Registro de los discos en el sistema. Esto le asignará a cada dispositivo un dispositivo físico en <code class="filename">/dev/</code>.</p><p>En el caso de tarjetas <span class="emphasis"><em>Qlogic 2340</em></span>:</p><p>Por cada dispositivo que presente un "<span class="emphasis"><em>*</em></span>" en cada tarjeta tendremos que hacer:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>echo "add-single-device  R C T L" &gt; /proc/scsi/scsi</code></strong>
<code class="prompt">[root@sal]# </code>
</pre><p>Donde:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>R</em></span> es la tarjeta. El número dentro de <code class="filename">/proc/scsi/qla2300/</code>.</p></li><li><p><span class="emphasis"><em>C</em></span> es el canal. Normalmente es cero. Se puede verificar en <code class="filename">/proc/scsi/scsi</code>.</p></li><li><p><span class="emphasis"><em>T</em></span> es el target y viene especificado por el campo <span class="emphasis"><em>Id</em></span>.</p></li><li><p><span class="emphasis"><em>L</em></span> es el lun.</p></li></ul></div><p>Una vez registrados todos los dispositivos:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>cat /proc/scsi/qla2300/1</code></strong>
<code class="computeroutput">QLogic PCI to Fibre Channel Host Adapter for QLA2340:
        Firmware version:  3.02.13, Driver version 6.06.00
Entry address = ce800060
HBA: QLA2312 , Serial# P19322
Request Queue = 0xe8ec000, Response Queue = 0xe8d0000
Request Queue count= 128, Response Queue count= 512
Total number of active commands = 0
Total number of interrupts = 12
Total number of IOCBs (used/max) = (0/600)
Total number of queued commands = 0
    Device queue depth = 0x20
Number of free request entries = 127
Number of mailbox timeouts = 0
Number of ISP aborts = 0
Number of loop resyncs = 0
Number of retries for empty slots = 0
Number of reqs in pending_q= 0, retry_q= 0, done_q= 0, scsi_retry_q= 0
Host adapter:loop state= &lt;READY&gt;, flags= 0x8e0813
Dpc flags = 0x0
MBX flags = 0x0
SRB Free Count = 4096
Link down Timeout = 000
Port down retry = 030
Login retry count = 030
Commands retried with dropped frame(s) = 0


SCSI Device Information:
scsi-qla0-adapter-node=200000e08b17da2e;
scsi-qla0-adapter-port=210000e08b17da2e;
scsi-qla0-target-0=5005076300c4a585;
scsi-qla0-target-1=5005076300c3a585;
scsi-qla0-target-2=5005076300c2a585;
scsi-qla0-target-3=5005076300cca585;
scsi-qla0-target-4=5005076300cba585;
scsi-qla0-target-5=5005076300caa585;

SCSI LUN Information:
(Id:Lun)  * - indicates lun is not registered with the OS.
( 0: 0): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:81,
( 0: 1): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:81,
( 0: 2): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:81,
( 1: 0): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:82,
( 1: 1): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:82,
( 1: 2): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:82,
( 2: 0): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:83,
( 2: 1): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:83,
( 2: 2): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:83,
( 3: 0): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:84,
( 3: 1): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:84,
( 3: 2): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:84,
( 4: 0): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:85,
( 4: 1): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:85,
( 4: 2): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:85,
( 5: 0): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:86,
( 5: 1): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:86,
( 5: 2): Total reqs 0, Pending reqs 0, flags 0x0, 0:0:86,</code>
<code class="prompt">[root@sal]# </code>
</pre><p>En el caso de tarjetas <span class="emphasis"><em>Qlogic 2462</em></span>:</p><p>Por cada dispositivo que presente un "<span class="emphasis"><em>*</em></span>" en cada tarjeta tendremos que hacer:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>echo "- - -" &gt; /sys/class/scsi_host/host1/scan</code></strong>
<code class="prompt">[root@sal]# </code>
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>Cada una de las "<span class="emphasis"><em>-</em></span>" hace referencia a <span class="emphasis"><em>bus</em></span>, <span class="emphasis"><em>target</em></span> y <span class="emphasis"><em>lun</em></span> del dispositivo.</p></div><p>Con esto registramos todos los dispositivos físicos que están sin registrar en el sistema para la tarjeta <span class="emphasis"><em>host1</em></span>:</p><pre class="screen">
<code class="prompt">[root@sal]# </code><strong class="userinput"><code>cat /proc/scsi/qla2xxx/1</code></strong>
<code class="computeroutput">QLogic PCI to Fibre Channel Host Adapter for QMC2462S:
        Firmware version 4.00.18 [IP] , Driver version 8.01.04-d7
ISP: ISP2422
Request Queue = 0x7cc00000, Response Queue = 0x7d3c0000
Request Queue count = 4096, Response Queue count = 512
Total number of active commands = 0
Total number of interrupts = 15422987
    Device queue depth = 0x20
Number of free request entries = 2201
Number of mailbox timeouts = 0
Number of ISP aborts = 0
Number of loop resyncs = 0
Number of retries for empty slots = 0
Number of reqs in pending_q= 0, retry_q= 0, done_q= 0, scsi_retry_q= 0
Host adapter:loop state = &lt;READY&gt;, flags = 0x1e03
Dpc flags = 0x4000000
MBX flags = 0x0
Link down Timeout = 030
Port down retry = 030
Login retry count = 030
Commands retried with dropped frame(s) = 0
Product ID = 0000 0000 0000 0000


SCSI Device Information:
scsi-qla0-adapter-node=200000e08b859383;
scsi-qla0-adapter-port=210000e08b859383;
scsi-qla0-target-0=5006016030224a8b;
scsi-qla0-target-1=5006016930224a8b;

FC Port Information:
scsi-qla0-port-0=50060160b0224a8b:5006016030224a8b:010000:81;
scsi-qla0-port-1=50060160b0224a8b:5006016930224a8b:010400:82;

SCSI LUN Information:
(Id:Lun)  * - indicates lun is not registered with the OS.
( 0: 0): Total reqs 256859, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 1): Total reqs 8897026, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 2): Total reqs 8533818, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 3): Total reqs 216979, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 4): Total reqs 76, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 5): Total reqs 77, Pending reqs 0, flags 0x0, 0:0:81 00
( 0: 6): Total reqs 77, Pending reqs 0, flags 0x0, 0:0:81 00
( 1: 0): Total reqs 14431, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 1): Total reqs 14444, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 2): Total reqs 14463, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 3): Total reqs 14450, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 4): Total reqs 15, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 5): Total reqs 15, Pending reqs 0, flags 0x0, 0:0:82 00
( 1: 6): Total reqs 21, Pending reqs 0, flags 0x0, 0:0:82 00</code>
<code class="prompt">[root@sal]# </code>
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Importante</h3><p>Es necesario hacer esto para cada tarjeta, <span class="emphasis"><em>hostn</em></span>, que tenga dispositivos sin registrar en el sistema.</p></div></li></ol></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ch06.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ch06s03.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Capítulo 6. Introducción al uso de <span class="emphasis"><em>SAN</em></span> en GNU/Linux </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> Dispositivos virtuales</td></tr></table></div></body></html>
