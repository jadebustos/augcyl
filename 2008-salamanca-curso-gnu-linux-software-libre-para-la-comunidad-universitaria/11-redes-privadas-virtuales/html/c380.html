<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Redes Privadas Virtuales (VPN)</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GNU/Linux, software libre para la comunidad universitaria"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Acceso remoto seguro"
HREF="c347.html"><LINK
REL="NEXT"
TITLE="IPsec"
HREF="x415.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GNU/Linux, software libre para la comunidad universitaria: Redes privadas virtuales en GNU/Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c347.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x415.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="AEN380"
></A
>Cap狎ulo 6. Redes Privadas Virtuales (VPN)</H1
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN382"
>6.1. Soluciones VPN para GNU/Linux</A
></H1
><P
>VPN es el acr칩nimo en ingl칠s de red privada virtual. El objetivo es lograr, mediante la creaci칩n de un t칰nel IP cifrado sobre una red p칰blica como Internet, que los nodos a conectar por la VPN virtualmente est칠n en una misma red local. Es posible establecer una VPN directamente entre dos nodos, pero lo m치s habitual es o bien una VPN entre un nodo remoto y la red local de la empresa (esta configuraci칩n en ingl칠s se llama con frecuencia road warrior, guerrero de la carretera, hace menci칩n a que un usuario m칩vil se conecta a la empresa con su port치til y una conexi칩n a Internet desde all칤 d칩nde est치 desplazado) o una VPN que une dos redes, por ejemplo dos filiales de una empresa o una filial con la central.</P
><P
>Hay distintas tecnolog칤as y productos para crear una VPN con implementaciones libres para GNU/LInux: </P
><P
></P
><OL
TYPE="1"
><LI
><P
>IPsec: el est치ndar por excelencia, ser치 obligatorio en IPv6 y est치 implementado en muchas pilas TCP/IP tambi칠n para la actual generaci칩n IPv4, incluyendo el kernel Linux. Se implementa directamente sobre la capa 3 (IP) mientras que el resto de soluciones suelen implementarse a nivel de capa de aplicaci칩n (aunque conceptualmente PPTP y L2TP son protocolos de capa de datos, se implementan como t칰neles, en el caso de L2TP s칤 es sobre UDP, en el caso de PPTP se usa GRE, que es un protocolo sobre IP). A diferencia de otras soluciones permite tanto t칰neles (modo t칰nel, entre dos security gateways, SG) como directamente cifrar la capa de transporte (modo transporte), lo que es 칰til cuando s칩lo se quiere seguridad entre dos m치quinas o ya se implementa el t칰nel sobre una capa posterior (t칤picamente la de aplicaci칩n, utilizando paquetes UDP).</P
></LI
><LI
><P
>PPTP: protocolo impulsado por Microsoft. Su implementaci칩n original ten칤a varios fallos graves y adem치s existe el problema de que no est치 tan probado como IPsec siendo tambi칠n relativamente compleja. No es un est치ndar, aunque se public칩 un RFC informativo describiendo el protocolo. El nombre completo es Point to Point Tunneling Protocol. Hay clientes de PPTP en Windows desde Windows 95, aunque Microsoft trata ahora de substituir PPTP por LLTP e IPsec, si bien PPTP ha tenido cierto 칠xito por su sencillez de configurar: no se usan claves p칰blicas, sino las propias cuentas de Windows para autenticar el acceso. </P
><P
>Hay implementaciones para GNU/Linux interoperables con la implementaci칩n de Microsoft tanto del cliente (<A
HREF="http://pptpclient.sourceforge.net/"
TARGET="_top"
>http://pptpclient.sourceforge.net/</A
>) como del servidor (<A
HREF="http://pptpclient.sourceforge.net/"
TARGET="_top"
>http://pptpclient.sourceforge.net/</A
>) . A destacar que los desarrolladores de estas implementaciones recomiendan no usar PPTP m치s que si no queda otro remedio: en su lugar recomienda OpenVPN o IPsec.</P
><P
>En Ubuntu 7.10, el cliente PPTP forma parte de los paquetes oficiales. Hay adem치s un applet para network-manager, aunque este ya no es oficial.</P
></LI
><LI
><P
>L2TP: Layer 2 Tunnel Protocol: promovido por Microsoft y CISCO, sigue la v칤a de estandarizaci칩n del IETF (es el RFC2661). Es un protocolo que hace t칰neles a nivel de la capa de aplicaci칩n (mediante paquetes UDP, aunque en principio puede encapsularse sobre otro tipos de redes no IP) para transportar tr치pico layer2. Mediante L2TP se crea un t칰nel entre el LAC (L2TP Access Concetrator, el cliente) y el LNS (L2TP Network Server): una vez creado el t칰nel, cualquiera de las dos partes puede abrir sesiones y estas sesiones se multiplexar치n sobre el t칰nel; un uso t칤pico es crear una sesi칩n PPP. L2TP garantiza fiabilidad en los paquetes de control, mientras que en los de datos como es propio de UDP podr치n perderse. </P
><P
>En realidad L2TP no implementa por s칤 s칩lo una VPN, dado que no cifra la informaci칩n, por lo que o bien usa PPTP o lo recomendado, usa un t칰nel IPsec (es decir, se usa un t칰nel IPsec para a su vez encapsular el t칰nel L2TP: esto tambi칠n se estandariza por el IETF, en el RFC ).</P
><P
>쯈u칠 sentido tiene usar L2TP sobre IPsec, pudiendo usar directamente IPsec? una raz칩n es usar la autenticaci칩n PPP (por ejemplo un servidor Radius) y la parte de autoconfiguraci칩n (por ejemplo proporcionar la informaci칩n DNS); no obstante con IPsec tambi칠n es posible autenticaci칩n y asignar IP y DNS sin necesidad de L2TP. As칤 mismo L2TP crea t칰neles a nivel 2, por lo que puede ir todo tipo de tr치fico, no necesariamente IP, por ejemplo puede ir tr치fico IPX o incluso se puede transportar directamente paquetes de nivel 2 como ATM. As칤 mismo L2TP en gran medida es m치s interesante para proveedores de Internet que tengan que encapsular informaci칩n (por ejemplo puede multiplexar varias sesiones L2TP sobre un t칰nel L2TP/IPsec), que para VPNs entre oficinas (por ejemplo para revender acceso a Internet), pero en cualquier caso se agradece que haya implementaciones para GNU/Linux pues habr치 servidores que no permitan conectarse directamente usando IPsec (quiz치s por desear usar la autenticaci칩n PPP) y requieran L2TP. En concreto usan L2TP adem치s de Microsoft, CISCO y MacOSX . En el art칤culo de la Wikipedia hay enlaces a las implementaciones existentes as칤 como a un tutorial: <A
HREF="http://en.wikipedia.org/wiki/L2TP"
TARGET="_top"
>http://en.wikipedia.org/wiki/L2TP</A
>
</P
></LI
><LI
><P
>OpenVPN: es la soluci칩n recomendada, por su sencillez: hace un t칰nel TLS sobre el que se encapsulan paquetes layer 3 (IP) o layer 2 (Ethernet), pero usando UDP en lugar de TCP, aunque tambi칠n se puede usar sobre TCP e incluso pasar a trav칠s de proxies HTTP. En realidad TLS no se puede implementar directamente sobre UDP, porque requiere un protocolo fiable como TCP y con UDP se tiene que permitir la p칠rdida de paquetes. Por ello en realidad TLS se usa para la funcionalidad de control, como negociar la sesi칩n TLS o renegociarla en un momento dado (implementando sobre UDP un sistema para pedir de nuevo los paquetes que se puedan perder y son importantes por ser de control), sustituyendo a los protocolos PKI de IPsec. Pero adem치s se han imitado los mecanismos presentes en las cabeceras <A
NAME="AEN402"
HREF="#FTN.AEN402"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
> de IPsec para dar seguridad a nivel de paquete y con independencia de si se pierde el paquete anterior: para ello hay que a침adir una secuencia a los paquetes, as칤 como un HMAC y contemplar varios mecanismos. Una idea similar es la que se sigue en la implementaci칩n del est치ndar DTLS (Datagram TLS: <A
HREF="http://es.wikipedia.org/wiki/Datagram_Transport_Layer_Security"
TARGET="_top"
>http://es.wikipedia.org/wiki/Datagram_Transport_Layer_Security</A
>) que se define en el RFC4347 y cuya 칰nica implementaci칩n actual conocida es la que hace el proyecto OpenSSL. En <A
HREF="http://unix.freshmeat.net/projects/dtls_example/"
TARGET="_top"
>http://unix.freshmeat.net/projects/dtls_example/</A
> hay c칩digo de ejemplo. Es posible que en un futuro se modifique OpenVPN para usar DTLS en lugar de su propio protocolo.</P
></LI
><LI
><P
>Montar una VPN sobre la marcha con OpenSSH y pppd o OpenSSH con TUN. Es una soluci칩n de compromiso ante una necesidad puntual. Si hemos instalado SSH y dejamos que pase el cortafuegos por si necesitamos conectarnos o lo usamos para cifrar un tunel con la conexi칩n el acceso a escritorio remoto, en un momento dado podemos instalar una VPN. La idea es utilizar el software de PPP (pppd) para crear los dispositivos de red en cada extremo y comunicarlos por un t칰nel SSH: el software PPP escribe por salida est치ndar lo que lee del dispositivo de red e igualmente lo que lee por salida est치ndar lo pone en el dispositivo de red. Con SSH se pueden comunicar las entradas salidas de dos programas, formando un t칰nel. Si lo preferimos, podemos hacer el t칰nel utilizando Stunnel en lugar de OpenSSH. Otra opci칩n es utilizar la opci칩n de hacer un t칰nel con TUN de SSH. Una ventaja es que es algo m치s sencillo, se puede lanzar sin privilegios y existe TUN incluso para Windows, aunque no por ejemplo para Mac OS X. Otra ventaja es que se puede usar TAP en lugar de TUN y usarlo para hacer un bridge: pppd necesita parchearse para funcionar en un bridge (soporte BCP), pues no transmite tramas Ethernet, sino por defecto tramas IP (aunque en Linux puede transmitir IPX en lugar de IP). Otra utilidad que puede hacer el papel de openssh +TUN pero m치s ligera es socat (la mencionamos al hablar de netcat). Socat es una utilidad realmente vers치til que tambi칠n puede reemplazar a stunnel.</P
></LI
><LI
><P
>Usar un cliente sobre la VPN proporcionada por un encaminador CISCO. El cliente, al igual que OpenVPN, no necesita de ning칰n soporte en el k칠rnel. salvo TUN/TAP. Web: <A
HREF="http://www.unix-ag.uni-kl.de/~massar/vpnc/"
TARGET="_top"
>www.unix-ag.uni-kl.de/~massar/vpnc/</A
>
</P
></LI
><LI
><P
>En grandes empresas, usar la infraestructura de VPN que ofrezca el operador para unir dos sedes (no es por tanto soluci칩n general para teletrabajo, especialmente si no tiene por qu칠 coincidir el operador), de modo que se tiene una red privada virtual como si se tuviera una l칤nea dedicada o una conexi칩n dedicada a trav칠s de una red de conmutaci칩n de circuitos como las l칤neas telef칩nicas anal칩gicas. T칤picamente esto es posible si el operador utiliza MPLS, u otras tecnolog칤as m치s antiguas como ATM o Frame Relay. Obviamente, requiere que el operador comercialice la posibilidad de conectar dos sedes entre s칤 en lugar de s칩lo dar servicio a Internet.</P
></LI
></OL
><P
>El paquete NetworkManager (<A
HREF="http://www.gnome.org/projects/NetworkManager/"
TARGET="_top"
>www.gnome.org/projects/NetworkManager/</A
>) dispone de plugins para OpenVPN, PPTP y VPNC (para este 칰ltimo programa soporta los ficheros .pcf, que ser칤a lo 칰nico que tendr칤a que distribuir el administrador). En el caso de la versi칩n incluida en Ubuntu 7.10, s칩lo aparece la opci칩n de configurar VPN si la tarjeta est치 en modo "itinerante", lo que excluye la configuraci칩n manual.</P
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notas</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN402"
HREF="c380.html#AEN402"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>IPsec define dos protocolos para dar seguridad a los paquetes, AH y ESP. AH garantiza la integridad y previene replay attacks, mientras que ESP adem치s de eso cifra. AH garantiza la integridad tambi칠n de las cabeceras (por lo que no puede usarse con NAT), pero en general no es muy 칰til para una VPN frente a ESP, pues normalmente IPsec se usa en modo t칰nel, no en modo transporte, y en este caso las Ips origen y destino van dentro del paquete. No obstante s칤 podr칤a ser 칰til para que los routers est칠n seguros que el tr치fico proviene de determinado router, suponiendo que se use un certificado que reconozcan y que efectivamente los "secure gateway", es decir, los extremos del t칰nel, coincidan con los enrutadores. En modo transporte sin AH la IP de origen se puede falsificar. En modo t칰nel se podr칤a falsificar la direcci칩n del router origen o destino entre los que se establece la VPN, pero no las IP origen y destino de los paquetes, que es lo que importa a los usuarios finales. Si se desea, se puede encapsular ESP en un paquete AH, pero rara vez se hace. Bruce Schneier recomienda simplificar IPsec y eliminar el modo de transporte y AH. dejando s칩lo ESP y modo t칰nel.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c347.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x415.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Acceso remoto seguro</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>IPsec</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>