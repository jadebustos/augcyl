<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Soluciones de virtualizaci칩n/redes con virtualizadores</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GNU/Linux, software libre para la comunidad universitaria"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Caso pr치ctico: router red local, red otra empresa, Internet"
HREF="c724.html"><LINK
REL="NEXT"
TITLE="Virtualizaci칩n para aprender sobre redes"
HREF="x786.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GNU/Linux, software libre para la comunidad universitaria: Redes privadas virtuales en GNU/Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c724.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x786.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="AEN748"
></A
>Cap狎ulo 10. Soluciones de virtualizaci칩n/redes con virtualizadores</H1
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN750"
>10.1. Virtualizaci칩n</A
></H1
><P
>Mediante la virtualizaci칩n en una sola m치quina es posible tener varios sistemas, como si en lugar de un PC tuvi칠ramos varios. As칤, un ISP que ofrezca servidores dedicados puede ofrecer varios servidores virtuales sobre una m치quina: cada uno funcionar치 como un servidor independiente con su propia IP, se podr치n instalar todo tipo de servicios (DNS, mail, Jabber, web, PostgreSQL) y reiniciar y administrar independientemente.</P
><P
>Al sistema sobre el que se ejecuta el virtualizador se le llama host; a veces tambi칠n se habla de domain 0, porque cada sistema que se ejecuta se le considera un dominio. A cada uno de los sistemas que se ejecutan sobre el virtualizador se les denomina guest. En algunos casos no hay sistema host porque el virtualizador se ejecuta directamente sobre el hardware.</P
><P
>Hay hardware como los mainframes de IBM, que soportan virtualizaci칩n. Los Pcs no soportan virtualizaci칩n: hay instrucciones de modo protegido que impiden ejecutar dos sistemas operativos simult치neamente, pero mediante software se pueden suplir (con bastante complejidad) las carencias de hardware. As칤 mismo mediante sofware se emulan componentes del hardware como discos, tarjeta gr치fica, de red y de sonido.</P
><P
>Adem치s de la virtualizaci칩n de la CPU, est치 la del resto del hardware: tarjeta de red, discos, tarjeta gr치fica... Para esta parte la mayor칤a de los proyectos libres toman c칩digo de Qemu.</P
><P
>Hay varios m칠todos de implementar la virtualiaci칩n del procesador:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Emuladores totales: emulan totalmente el hardware, incluyendo el procesador. Es el caso de Booch. Su rendimiento es muy pobre.</P
></LI
><LI
><P
>Emuladores con compilaci칩n JIT: es el caso de Qemu, cuando se ejecuta sin el m칩dulo kqemu. El c칩digo necesita "compilarse" para la m치quina virtual, si bien como los compiladores JIT de Java se hace s칩lo la primera vez que se ejecuta el c칩digo, luego ya est치 compilado. Mucho m치s r치pidos que los emuladores totales, pero m치s lentos que el resto de soluciones. Se puede ejecutar como usuario normal sin instalar nada como root. Se pueden emular procesadores distintos.</P
></LI
><LI
><P
>Virtualizadores completos: es el caso de Vmware (software privativo), Qemu con el m칩dulo de aceleraci칩n Kqemu (antes privativo ahora libre) y Virtual Box (software con una versi칩n libre y otra m치s funcional privativa). Se basan en un VMM (Virtual Machine Monitor, tambi칠n conocido como hypervisor) que mediante complicadas t칠cnicas (como traps y an치lisis del c칩digo antes de su ejecuci칩n) detecta en tiempo de ejecuci칩n el c칩digo que no puede ejecutarse directamente porque afectar칤a a todo el sistema, modificando din치micamente las instrucciones conflictivas. El rendimiento var칤a mucho seg칰n lo avanzado que sea el VMM: Vmware tiene varias patentes. Estos tres programas permiten instalar un sistema operativo sobre un virtualizador del mismo modo que sobre un PC: la ventana del virtualizador asemeja el monitor de un PC, podemos entrar en la BIOS, reiniciar el ordenador...</P
></LI
><LI
><P
>Paravirtualizadores: es el caso de Xen y UML (User mode Linux). En lugar de tener que detectar un VMM los casos conflictivos en tiempo de ejecuci칩n, se modifica el c칩digo fuente de los sistemas operativos para evitar esos casos conflictivos. En lugar de el VMM tener que analizar el c칩digo, es el c칩digo quien invoca al VMM cuando sea necesario. Esta t칠cnica simplifica much칤simo el VMM y ofrece muy buen rendimiento, aunque en el caso concreto de UML el rendimiento es mediocre. La pega es que haya que parchear el sistema operativo, sobre todo para poder ejecutar Windows. Xen parche칩 un Windows XP en un programa de investigaci칩n que permit칤a acceso al c칩digo fuente de Microsoft, pero ese tipo de licencias no permit칤a distribuir el resultado. UML tambi칠n se puede considerar dentro de esta categor칤a, pues es una modificaci칩n del kernel de Linux para que pueda ejecutarse dentro de otro Linux. Xen no emula una tarjeta gr치fica SVGA "completa" como Qemu, Vmware o VirtualBox, pero utiliza VNC que para el sistema guest se ve como una tarjeta VGA.</P
><P
>Vmware y VirtualBox no son paravirtualizadores, pero utilizan esta t칠cnica para virtualizar la E/S en los drivers especiales que se ejecutan en el sistema guest (por ejemplo el driver de red y el de la tarjeta gr치fica: se comunican con el hipervisor en lugar de ser drivers normales sobre el hardware emulado). Lo mismo planea hacer KVM.</P
></LI
><LI
><P
>Virtualizadores apoyados en el hardware (un tanto pretenciosamente llamados nativos): los procesadores de Intel actualmente en el mercado, los Core Duo y la mayor칤a, pero no todos (ver la wikipedia), de los Core Duo2 a침aden las extensiones VT y los m치s recientes de AMD (a partir de stepping F; las extensiones se llaman SVM) cuentan con nuevas instrucciones que permiten la virtualizaci칩n de la CPU. De este modo ya no es necesario un complicado VMM ni parchear el sistema operativo, si bien sigue siendo necesario virtualizar otros dispositivos y emular discos, tarjetas gr치ficas, de red... Ejemplos de estas soluciones son KVM (integrado en el kernel desde la versi칩n 2.6.20, utiliza qemu para la virtualizaci칩n del resto del hardware) y Virtual Iron (basado en Xen, pero ya no es paravirtualizador; en cualquier caso es una soluci칩n propietaria, con algo de c칩digo bajo GPL). Adem치s Xen soporta tambi칠n estas instrucciones, como m칠todo para poder ejecutar Windows o simplemente sistemas sin paravirtualizar. Los virtualizadores apoyados en el hardware son m치s lentos que los paravirtualizadores e incluso que los virtualizadores completos, al menos que los que tienen un VMM avanzado. VirtualBox no usa por defecto estas instrucciones, aunque las soporte, por este motivo. Lo mismo ocurre con Vmware, aunque s칤 lo utiliza para poder utilizar como host un sistema operativo de 64bits (VirtualBox actualmente no permite esta configuraci칩n). </P
></LI
><LI
><P
>Virtualizaci칩n a nivel de sistema operativo (OS level Virtualization): no permite ejecutar dos sistemas operativos simult치neamente, sino servidores privados virtuales (SVP) dentro de un 칰nico servidor, es decir, es un 칰nico kernel, pero que permite aislar (isolate) los servidores. Cada servidor tendr치 su propia red, espacio de disco, de memoria, se podr치 reiniciar.. as칤 mismo tendr치 limitaci칩n de uso de CPU con el fin de evitar que un servidor virtual esquilme recursos de los otros. Tambi칠n esta tecnolog칤a se denomina como Jail, pues es extender el concepto de chroot. Tantao Linux VServer como Virtuozzo lo vienen ofreciendo proveedores de hosting desde hace a침os. Estas son las dos soluciones libres m치s destacadas: </P
><P
></P
><OL
TYPE="a"
><LI
><P
>Linux VServer: <A
HREF="http://linux-vserver.org/"
TARGET="_top"
>http://linux-vserver.org</A
> (no confundir con linux virtual server, que es sobre clusters). Software libre. Una limitaci칩n es que no admite usar iptables dentro de cada SVP, sino dentro del host. Tampoco admite migraci칩n de procesos. As칤 mismo est치 m치s limitado en lo que se virtualiza, por ejemplo no se virtualiza nada de /proc). Por otro lado la distribuci칩n host parece menos restringida que en OpenVZ, que como host s칩lo admite Fedora, algunas versiones de CentOS y algunas de RHEL. Hay varias distribuciones que funcionan como guest directamente (las instalamos en su partici칩n y luego las usamos, con sus programas y librer칤as, pero no obviamente con su kernel) aunque otras como Gentoo no. </P
></LI
><LI
><P
>OpenVZ (<A
HREF="http://openvz.org/"
TARGET="_top"
>http://openvz.org</A
>). Virtuozzo es un virtualizador bajo una licencia privativa; OpenVZ es el producto de la misma compa침칤a que es software libre y que es la base de Virtuozzo. Un hecho positivo es que OpenVZ no es un conjunto de c칩digo GPL dif칤cil de integrar y sin soporte como ocurre con otros productos en los que hay versi칩n GPL y privativa: tambi칠n venden soporte para OpenVZ. Admite distintas distribuciones como host, a trav칠s de templates, que son repositorios para bajar los paquetes necesarios para esa distribuci칩n. Hosting con OpenVZ: <A
HREF="http://www.vpslink.com/vps-hosting/"
TARGET="_top"
>http://www.vpslink.com/vps-hosting/</A
>. En alg칰n caso es m치s caro con OpenVZ que con Virtuozzo, por ser menos maduro y requerir m치s recursos... </P
></LI
></OL
></LI
></OL
><P
>Entre las posibilidades m치s avanzadas de algunos virtualizadores est치 el migrar en caliente con una indisponibilidad inapreciable un dominio de un servidor a otro. Dentro de los productos libres lo permiten Xen, KVM y OpenVZ. Vmware lo permite s칩lo en su servidor de pago (EXS). En Vmware Server (antiguo Vmware GSX), ahora gratis (que no libre) no es posible. Para saber m치s sobre este tema: <A
HREF="http://kvm.qumranet.com/kvmwiki/Migration"
TARGET="_top"
>http://kvm.qumranet.com/kvmwiki/Migration</A
>
</P
><P
>Un debate interesante es el de los virtualizadores que se ejecutan "bare metal", es decir, directamente sobre el hardware, en lugar de sobre un sistema operativo "host". Vmware EXS sigue esta f칩rmula de forma pura, de tal modo que s칩lo funciona con determinado hardware. En el caso de Xen, se ejecuta sobre un host, pero asume parte de las funciones de un sistema operativo, al tener c칩digo por ejemplo para planificar la CPU. En cambio KVM utiliza todo lo que aporta Linux, lo que para muchos desarrolladores es la opci칩n preferible pues dif칤cilmente una empresa que desarrolla un producto de virtualizaci칩n tendr치 m치s experiencia en elementos de sistemas operativos como un planificador, que el grupo de personas que llevan desarrollando estos componentes desde hace a침os en un sistema tan extendido como el kernel Linux.</P
><P
>Software interesante:</P
><P
>http://virt-manager.et.redhat.com/ interfaz gr치fica sobre todo para Xen, pero tambi칠n soporta KVM y Qemu. Incluye parte para gestionar redes.</P
><P
>Informaci칩n muy completa (navegar por los enlaces del marco de la izquierda):
<A
HREF="http://virt.kernelnewbies.org/TechOverview"
TARGET="_top"
>http://virt.kernelnewbies.org/TechOverview</A
>
</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c724.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x786.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Caso pr치ctico: router red local, red otra empresa, Internet</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Virtualizaci칩n para aprender sobre redes</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>