<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Francisco J. Palacios Burgos">
   <meta name="GENERATOR" content="Mozilla/4.76 [es] (X11; U; Linux 2.4.2-2 i686) [Netscape]">
   <title>Taller de Perl - Perl B&aacute;sico</title>
</head>
<body background="fondo.jpg">

<div ALIGN=right>
<h3>
<img SRC="camel.gif" height=149 width=144></h3></div>

<h3>
8. Un par de ejemplos</h3>

<p><br><font color="#000000"><a href="ejemplo12.pl">ejemplo12.pl</a></font>
<table BORDER COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC" NOSAVE >
<tr NOSAVE>
<td NOSAVE><font color="#993399">#!/usr/bin/perl -w</font>
<p><font color="#3333FF"># Programa que lee un fichero y si encuentra una
ruta (ej: /home/users/) borra</font>
<br><font color="#3333FF"># el / al final</font>
<p>open (FILE, "<font color="#006600">$ARGV[</font><font color="#CC33CC">0</font><font color="#006600">]</font>");
<p>while(<font color="#006600">$line</font>=&lt;FILE>)
<br>{
<br>&nbsp;&nbsp; <font color="#006600">$line</font> =~ s/&nbsp; ((\w|\/)+)(\/)
/ <font color="#006600">$1</font> /;
<br>&nbsp;&nbsp; print <font color="#006600">$line</font>;
<br>}
<p>close(FILE);</td>
</tr>
</table>

<p>El programa anterior es una primera aproximaci&oacute;n. A veces lo
m&aacute;s dificil es tener en cuenta las excepciones. As&iacute;, si en
el fichero apareciese la cadena "<font color="#FF0000">//////////</font>"
tamb&iacute;en eliminar&iacute;a el &uacute;ltimo <b><font color="#FF0000">'/'</font></b>,
aunque no se trate de una ruta. Quiz&aacute;s una expresi&oacute;n regular
m&aacute;s adecuada para una ruta ser&iacute;a:
<p>&nbsp;\/ ((\w)+(\/))* (\w)+(\/)
<p>es decir, un primer / (todas las rutas empiezan el el ra&iacute;z) seguida
de una serie de repeticiones (pueden ser cero) de (\w)+(\/) y finalizan
con un &uacute;ltimo (\w)+(\/), cuyo / ser&iacute;a el que tendr&iacute;amos
que sustituir. El caso en que la ruta haga menci&oacute;n a un subdirectorio
del ra&iacute;z es cuando se produce 0 veces en el ((\w)+(\/))*
<br>&nbsp;
<p><font color="#000000"><a href="ejemplo13.pl">ejemplo13.pl</a></font>
<table BORDER COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC" NOSAVE >
<tr NOSAVE>
<td NOSAVE><font color="#993399">#!/usr/bin/perl -w</font>
<p><font color="#3333FF"># Programa que partiendo de una plantilla de una
carta y una lista de registros</font>
<br><font color="#3333FF"># elabora varias cartas personalizadas</font>
<p>open(RECS, "<font color="#FF0000">records.txt</font>");
<p>open(PLANT, "<font color="#FF0000">plantilla.txt</font>");
<br>&nbsp;&nbsp; <font color="#006600">@plantilla</font> = &lt;PLANT>;
<br>close(PLANT);
<p><font color="#006600">$firmante</font> = <font color="#006600">$ARGV[</font><font color="#993399">0</font><font color="#006600">]</font>;
<br>(<font color="#006600">$sec</font>,<font color="#006600">$min</font>,<font color="#006600">$hour</font>,<font color="#006600">$mday</font>,<font color="#006600">$mon</font>,<font color="#006600">$year</font>,<font color="#006600">$wday</font>,<font color="#006600">$yday</font>)
= gmtime;
<br><font color="#006600">$fecha</font> = "<font color="#006600">$mday
</font><font color="#FF0000">de&nbsp; </font><font color="#006600">$mon
</font><font color="#FF0000">de&nbsp; </font><font color="#006600">$year</font>";
<p>while(<font color="#006600">$line</font>=&lt;RECS>)
<br>{
<br>&nbsp;&nbsp; chop <font color="#006600">$line</font>;
<br>&nbsp;&nbsp; <font color="#006600">@tokens</font> = split(<b><font color="#FF0000">/:/</font></b>,<font color="#006600">$line</font>);&nbsp;
<br>&nbsp;&nbsp; open(CARTA,"> <font color="#006600">$tokens[</font><font color="#993399">0</font><font color="#006600">]</font><font color="#FF0000">.txt</font>");
<br>&nbsp;&nbsp; foreach <font color="#006600">$line2</font>(<font color="#006600">@plantilla</font>)
<br>&nbsp;&nbsp; {
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#006600">$line2 </font>=~
s / <b><font color="#993399">\[</font></b>DIRECCION<b><font color="#993399">\]
</font></b>/
<font color="#006600">$tokens[</font><font color="#993399">1</font><font color="#006600">]
</font>/;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#006600">$line2</font>
=~ s/ <b><font color="#993399">\[</font></b>FECHA<b><font color="#993399">\]
</font></b>/
<font color="#006600">$fecha
</font>/;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#006600">$line2</font>
=~ s/<b><font color="#993399"> \[</font></b>DESTINO<b><font color="#993399">\]
</font></b>/
<font color="#006600">$tokens[</font><font color="#993399">0</font><font color="#006600">]
</font>/;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#006600">$line2</font>
=~ s/ <b><font color="#993399">\[</font></b>FIRMANTE<b><font color="#993399">\]
</font></b>/
<font color="#006600">$firmante
</font>/;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print CARTA "<font color="#006600">$line2</font>";
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; close(CARTA);
<br>}
<p>close(RECS);</td>
</tr>
</table>

<p>Este programa tal cu&aacute;l est&aacute; no funciona correctamente.
Aunque se generan los ficheros correctos, el contenido de los mismos no
est&aacute; bien, apareciendo en todos como destinatario la misma persona.
La raz&oacute;n para ellos est&aacute; en en que la primera vez que hacemso
el foreach, la plantilla se destruye, porque estamos sustituyendo en la
misma plantilla y la siguiente vez ya no habr&aacute; por ejemplo una cadena
[DIRECCION]. La soluci&oacute;n consiste en volver a leer la plantilla
o bien en usar una variable temporal para hacer las sustituciones. En el
<font color="#000000"><a href="ejemplo13.pl">ejemplo13.pl</a></font>
est&aacute; corregido.
<br>&nbsp;
<div align=right>
<hr WIDTH="100%"></div>

<br>&nbsp;
<center><table BORDER=0 COLS=3 WIDTH="25%" NOSAVE >
<tr NOSAVE>
<td ALIGN=CENTER VALIGN=CENTER NOSAVE><a href="node5.html"><img SRC="ol.gif" BORDER=0 height=44 width=65></a></td>

<td ALIGN=CENTER VALIGN=CENTER NOSAVE><a href="index.html"><img SRC="home02.gif" BORDER=0 height=75 width=61></a></td>

<td ALIGN=CENTER VALIGN=CENTER NOSAVE><a href="node7.html"><img SRC="or.gif" BORDER=0 height=44 width=65></a></td>
</tr>

<tr NOSAVE>
<td ALIGN=CENTER VALIGN=CENTER NOSAVE><a href="node5.html">Anterior</a></td>

<td ALIGN=CENTER VALIGN=CENTER NOSAVE><a href="index.html">Home</a></td>

<td ALIGN=CENTER VALIGN=CENTER NOSAVE><a href="node7.html">Siguiente</a></td>
</tr>
</table></center>

</body>
</html>
